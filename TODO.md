# TODO / Дорожная карта

Набор типичных фич для менеджера домашней библиотеки и практичные способы их реализации в текущем Electron‑приложении.

## Приоритеты
- [P0] Критично/основа (сделать в первую очередь)
- [P1] Важно для версии 1.0
- [P2] Полезно для 1.x
- [P3] Дополнительно/расширения

## Каталог и метаданные
- [x] [P1] Расширенная схема книги: `title`, `authors[]`, `series`, `seriesIndex`, `year`, `publisher`, `isbn`, `format`, `language`, `genres[]`, `tags[]`, `rating`, `notes`, `location`.
- [x] [P1] Альтернативные поля для оригинала: `titleAlt`, `authorsAlt` (сохранение исходных значений при конвертации кириллицы).
- [ ] [P2] Серии и издания: поля `series` и `seriesIndex`; UI‑группировка по серии, сортировка по номеру.
- [ ] [P2] Форматы носителей: `format` (`paper`, `ebook`, `audiobook`), фильтры и иконки в UI.

## Файлы, обложки и вложения
- [ ] [P2] Вложения eBook/PDF: хранение копий в `userData/library/files`, в книге — `files[]` с `type`, `ext`, `size`.
- [ ] [P3] Генерация миниатюр: для ePub — cover из zip, для PDF — 1‑я страница через `pdfjs-dist`; кэш в `covers/`.
- [ ] [P2] Drag & Drop обложек: зона в форме, копирование и мгновенный предпросмотр.

## Чтение и выдача
- [ ] [P3] Прогресс чтения: `progress` 0–100, `lastReadAt`; индикатор в карточке.
- [ ] [P2] Учёт выдач: сущность `loans` (`borrower`, `dateOut`, `dueAt`, `dateIn`, `notes`); флаг «на руках», журнал.
- [ ] [P2] Рейтинг и заметки: звездочки/оценка и текстовые заметки (частично: поле rating/notes есть, нужен виджет звёзд и отображение в списке).

## Поиск и организация
- [x] [P0] Быстрый поиск: fuzzy‑поиск (Fuse.js) по названию/авторам/ISBN в рендерере (сделано для названия/авторов; осталось добавить по ISBN/тегам по желанию).
- [ ] [P1] Расширенные фильтры: авторы, жанры, формат, год, теги; сохранённые «умные коллекции».
- [ ] [P2] Дедупликация: поиск по нормализованным `title+authors` и/или `isbn`; мастер объединения записей.

## Импорт/экспорт/интеграции
- [ ] [P1] Импорт CSV/TSV: сопоставление колонок → предпросмотр → запись.
- [x] [P1] По ISBN: автозаполнение (ISBNdb как основной, Open Library fallback; кэш в БД с коротким TTL для «пустых», кнопка «Обновить» без кеша). Google Books — опционально.
- [ ] [P3] OPDS/каталоги: импорт из OPDS‑фидов для eBook библиотек.
- [ ] [P2] Расширенный бэкап: инкрементные бэкапы, расписание, опциональное шифрование (AES‑GCM), проверка целостности.

## UX и темизация
- [x] [P1] Детальная карточка/панель: модалка/слайд‑овер с метаданными, файлами, журналом (реализована модалка с расширенной формой).
- [x] [P1] Инструменты русификации: обратная транслитерация для названия/авторов из результатов провайдера + кнопка «Кириллицей» для поля «Издательство».
- [x] [P1] Настройки: модалка для ключей провайдеров (ISBNdb/Google Books), хранение в `userData/settings.json`.
- [ ] [P1] Режимы просмотра: сетка/список, плотность, сортировки (название, автор, дата добавления, серия).
- [ ] [P1] Клавиатурные шорткаты: N — новая книга, / — поиск, Del — удалить, Cmd/Ctrl+F — фокус поиска (частично: Esc закрывает модалку с подтверждением несохранённых изменений).
- [ ] [P2] Локализация (i18n): ресурсы JSON, переключатель языка, хранение выбора.
- [ ] [P2] Светлая/тёмная/системная тема: добавить «Системная» (следовать `prefers-color-scheme`).

## Данные и надёжность
- [x] [P0] Переход на SQLite: хранение на SQLite (реализовано через sql.js, wasm) с таблицами `books`, `authors`, `book_authors` и индексами.
- [ ] [P0] Транзакции/очередь записи: (частично) есть консистентное сохранение файла БД после операций; требуется батч‑запись и «атомарный» snapshot через tmp+rename.
- [x] [P0] Миграции: версия схемы `schema_version` и миграции v1→v4 (v3 — `isbn_cache`, v4 — `titleAlt`/`authorsAlt`).
- [x] [P0] Идентификаторы: UUID v4 для связей и внешних файлов.
- [x] [P1] Переменные окружения: поддержка `.env` (dotenv) и загрузка ключей в main.

## Безопасность и права
- [x] [P0] Доступ к ФС только в `main`: все операции файлов — через IPC; в рендерере без Node.
- [ ] [P2] Верификация импортов: проверка расширений/размеров, защита от zip‑slip при распаковке.

## Сборка и обновления
- [ ] [P1] Пакетирование: `electron-builder`/`electron-forge` для dmg/exe/AppImage; автообновления (при возможности) и подпись.
- [ ] [P1] Модульная структура: разделить `src/main/*` (ipc, storage, covers, importers) и `src/renderer/*` (views, state, components).

## Как реализовать ключевые блоки
- [x] [P0] SQLite (main): `src/main/db.js` — инициализация, миграции, CRUD; IPC: `books:list|create|update|delete`.
- [x] [P1] Импорт ISBN: агрегатор `src/main/providers/isbn.js` (ISBNdb → Open Library), кеш `isbn_cache`, IPC `meta:byIsbn`, кнопка «Обновить» (ignore cache).
- [ ] [P1] Импорт CSV: `src/main/importers/csv.js` — парсер, маппинг колонок, dry‑run + отчёт.
- [x] [P0] Поиск (renderer): `src/renderer/search.js` — Fuse.js, фильтры в памяти; для больших коллекций — IPC‑фильтры по SQLite.
- [ ] [P2] Вложения: копирование в `userData/library/files`, относительные пути; генерация миниатюр при импорте.

## Предложенный порядок работ
1) Перевести хранилище на SQLite с таблицами и индексами.
2) Добавить быстрый поиск, фильтры и сохранённые коллекции.
3) Импорт по ISBN с автозаполнением.
4) Поддержка вложений eBook/PDF и генерация обложек.
5) Дедупликация и мастер объединения записей.
