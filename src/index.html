<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–î–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</title>
    <link rel="icon" href="assets/icon.svg" />
    <link rel="stylesheet" href="assets/tailwind-lite.css" />
    <style>
      :root {
        --bg: #f6f7fb;
        --bg-gradient: radial-gradient(1200px 800px at -10% -20%, #ffffff 0%, #f6f7fb 60%),
                        radial-gradient(1000px 700px at 120% 0%, #f0f2f9 0%, #f6f7fb 60%);
        --surface: #ffffff;
        --muted-surface: #f2f4f8;
        --border: #e5e8f0;
        --text: #161827;
        --muted: #6b728e;
        --accent: #3b6fff;
        --accent-strong: #2b59ff;
        --danger: #e23d4f;
        --shadow: 0 8px 24px rgba(17, 24, 39, 0.08);
        --radius: 12px;
      }

      body.theme-dark {
        --bg: #0f1220;
        --bg-gradient: radial-gradient(1200px 800px at -10% -20%, #1d2240 0%, #0f1220 60%),
                        radial-gradient(1000px 700px at 120% 0%, #181d36 0%, #0f1220 60%);
        --surface: #161a2b;
        --muted-surface: #1b2035;
        --border: #242a44;
        --text: #e8ecff;
        --muted: #a6add6;
        --accent: #6c8cff;
        --accent-strong: #5274ff;
        --danger: #ff5d6c;
        --shadow: 0 8px 24px rgba(0,0,0,0.35);
      }

      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--text);
        background: var(--bg);
        background-image: var(--bg-gradient);
        background-attachment: fixed;
        font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        /* No transition on body - gradients can't be animated smoothly */
      }

      header {
        position: sticky; top: 0; z-index: 2;
        display:flex; align-items:center; justify-content:space-between;
        padding: 14px 18px;
        background: var(--surface);
        border-bottom: 1px solid var(--border);
      }
      header h1 { font-size: 16px; margin: 0; letter-spacing: 0.3px; }
      /* remove legacy margin that created inner padding in segments */
      /* header .actions button { margin-left: 8px; } */

      /* Main layout: one column by default; two columns from 1024px */
      main { display:grid; grid-template-columns: 1fr; box-sizing: border-box; padding: 18px; gap: 18px; }
      @media (min-width: 1024px) {
        main { grid-template-columns: 380px minmax(0, 1fr); }
      }

      /* Collapsible form on small screens */
      .form-toggle-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        user-select: none;
      }
      .form-toggle-header h3 { margin: 0; }
      .form-toggle-icon {
        transition: transform 0.2s ease;
        color: var(--muted);
      }
      .form-toggle-icon.collapsed { transform: rotate(-90deg); }
      .form-content { overflow: hidden; }
      @media (max-width: 1023px) {
        .form-content.collapsed {
          display: none;
        }
        .form-toggle-header { padding: 4px 0; }
      }
      @media (min-width: 1024px) {
        .form-toggle-header { cursor: default; }
        .form-toggle-icon { display: none; }
      }
      .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; box-shadow: var(--shadow); }
      .card h3 { margin: 0 0 6px; font-size: 15px; font-weight: 600; }
      label { display:block; font-size: 12px; color: var(--muted); margin-top: 8px; margin-bottom: 6px; }
      input[type="text"] {
        width: 100%; padding: 10px 12px; border:1px solid var(--border); border-radius:10px; box-sizing: border-box;
        background: var(--muted-surface); color: var(--text);
        outline: none; transition: box-shadow 120ms ease;
      }
      input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      textarea { width: 100%; padding: 10px 12px; border:1px solid var(--border); border-radius:10px; box-sizing: border-box;
        background: var(--muted-surface); color: var(--text);
        outline: none; transition: box-shadow 120ms ease; }
      textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      select { background: var(--surface); color: var(--text); border-color: var(--border); }
      .row { display:flex; gap:8px; align-items:center; }
      button { padding:9px 12px; border:1px solid var(--border); border-radius:10px; background: var(--muted-surface); color: var(--text); cursor:pointer; transition: transform 60ms ease; }
      button:active { transform: translateY(1px); }
      button.primary { background: linear-gradient(180deg, var(--accent) 0%, var(--accent-strong) 100%); border-color: rgba(43,89,255,0.6); color: #fff; }
      button.danger { background: linear-gradient(180deg, var(--danger) 0%, #cc4753 100%); border-color: #a43b45; color: #fff; }

      .cover-preview { width: 100%; max-height: 220px; object-fit: contain; background: repeating-conic-gradient(from 45deg, rgba(0,0,0,0.04) 0% 25%, rgba(0,0,0,0.02) 0% 50%) 50% / 20px 20px; border:1px dashed var(--border); border-radius: 10px; display:none; }
      .list { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
      .list.rows { grid-template-columns: 1fr; }
      .list.compact .book { padding:6px; gap:8px; }
      .list.compact .thumb { width:48px; height:68px; }
      .book { display:flex; gap:12px; background: var(--surface); border:1px solid var(--border); padding:12px; border-radius:12px; box-shadow: var(--shadow); cursor: pointer; align-items:flex-start; }
      .book { overflow: hidden; }
      .book.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      .book.loaned { border-color: rgba(226,61,79,0.4); box-shadow: 0 10px 24px rgba(226,61,79,0.08); }
      .book.loaned.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      .book.loaned .thumb { border-color: rgba(226,61,79,0.45); box-shadow: 0 0 0 2px rgba(226,61,79,0.16); }
      .thumb { width:64px; height:86px; object-fit:cover; background: var(--muted-surface); border-radius:8px; border:1px solid var(--border); display:none; }
      .thumb.loaned { border-color: rgba(226,61,79,0.45); box-shadow: 0 0 0 2px rgba(226,61,79,0.16); }
      .loan-badge { display:inline-flex; align-items:center; gap:8px; font-size:10px; font-weight:650; letter-spacing:0.05em; text-transform:uppercase; color: var(--danger); background: rgba(226,61,79,0.12); border:1px solid rgba(226,61,79,0.35); border-radius:999px; padding:2px 6px; margin-bottom:2px; width:max-content; }
      .loan-status { display:none; flex-direction:column; gap:6px; margin-top:10px; padding:10px 12px; background: rgba(226,61,79,0.08); border:1px solid rgba(226,61,79,0.25); border-radius:12px; color: var(--danger); }
      .loan-status-text { font-size:12px; color: var(--muted); white-space: pre-line; }
      .loan-status.visible { display:flex; }
      body.theme-dark .book.loaned { border-color: rgba(255,93,108,0.35); box-shadow: 0 10px 24px rgba(255,93,108,0.16); }
      body.theme-dark .book.loaned .thumb { border-color: rgba(255,93,108,0.45); box-shadow: 0 0 0 2px rgba(255,93,108,0.2); }
      body.theme-dark .loan-badge { background: rgba(255,93,108,0.22); border-color: rgba(255,93,108,0.45); color: #ffe2e5; }
      body.theme-dark .loan-status { background: rgba(255,93,108,0.22); border-color: rgba(255,93,108,0.45); color: #ffe2e5; }
      body.theme-dark .loan-status-text { color: rgba(255,226,229,0.85); }
      .history-view { display:flex; flex-direction:column; gap:12px; height:100%; }
      .history-controls { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
      .history-controls .input { height:34px; }
      .history-list-wrapper { flex:1; min-height:0; overflow-y:auto; }
      .history-list { display:flex; flex-direction:column; gap:8px; }
      .history-group { display:flex; flex-direction:column; gap:6px; }
      .history-date { font-size:12px; font-weight:600; color: var(--muted); text-transform:uppercase; letter-spacing:0.04em; }
      .history-item { border:1px solid var(--border); border-radius:10px; background: var(--surface); padding:10px 12px; }
      .history-item > summary { list-style:none; display:flex; align-items:center; gap:8px; cursor:pointer; font-weight:600; color: var(--text); }
      .history-item > summary::-webkit-details-marker { display:none; }
      .history-time { font-size:12px; color: var(--muted); min-width:46px; }
      .history-action-tag { font-size:11px; color: var(--muted); background: var(--muted-surface); border-radius:999px; padding:2px 6px; text-transform:uppercase; letter-spacing:0.06em; }
      .history-summary-text { flex:1; }
      .history-details { margin-top:6px; font-size:12px; color: var(--muted); display:flex; flex-direction:column; gap:6px; }
      .history-diff-table { width:100%; border-collapse:collapse; font-size:12px; }
      .history-diff-table th, .history-diff-table td { text-align:left; padding:4px 6px; border-bottom:1px solid var(--border); vertical-align:top; }
      .history-info-row { display:flex; gap:6px; }
      .history-info-row strong { color: var(--text); }
      .history-empty { color: var(--muted); font-size:13px; text-align:center; padding:24px 0; }
      .history-loadmore { display:flex; justify-content:center; margin-top:12px; }
      .meta { flex:1; min-width: 0; display:flex; flex-direction:column; gap:6px; }
      .title { font-weight:650; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .authors { color:var(--muted); font-size:12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .rating { display:inline-flex; align-items:center; gap:2px; margin-top:2px; font-size:0; }
      .rating .star { position:relative; display:inline-block; width:16px; height:16px; }
      .rating .star::before,
      .rating .star::after { content:'‚òÖ'; position:absolute; inset:0; font-size:16px; line-height:16px; color:#d1d5db; }
      .rating .star::after { content:''; }
      .rating .star.star--full::before { color:#fbbf24; }
      .rating .star.star--half::before { color:#fbbf24; clip-path: inset(0 50% 0 0); }
      .rating .star.star--half::after { content:'‚òÖ'; color:#d1d5db; clip-path: inset(0 0 0 50%); }
      .rating .star.star--empty::before { color:#d1d5db; }
      .meta .collections-badges { margin-top: 2px; }
      .meta .actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:4px; }
      .empty { color:var(--muted); padding:16px; }
      .dropzone { border: 1px dashed var(--border); border-radius: 10px; }
      .dropzone.active { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      .actions { display:flex; gap:8px; align-items:center; }
      .icon-btn { width:36px; height:36px; padding:0; border:1px solid var(--border); border-radius:8px; background:var(--surface); cursor:pointer; display:flex; align-items:center; justify-content:center; }
      .icon-btn:hover { background:var(--muted-surface); }
      .icon-btn svg { width:16px; height:16px; color:var(--text); }
      /* Theme toggle icons - show/hide based on theme */
      #themeToggle .icon-sun { display: none; }
      #themeToggle .icon-moon { display: block; }
      body.theme-dark #themeToggle .icon-sun { display: block; }
      body.theme-dark #themeToggle .icon-moon { display: none; }

      /* Theme toggle glow effects */
      #themeToggle {
        position: relative;
        overflow: visible;
      }
      /* Moon glow in light theme - cool blue/purple */
      #themeToggle .icon-moon {
        color: #6366f1;
        filter: drop-shadow(0 0 3px rgba(99, 102, 241, 0.5)) drop-shadow(0 0 6px rgba(99, 102, 241, 0.3));
      }
      #themeToggle:hover .icon-moon {
        filter: drop-shadow(0 0 4px rgba(99, 102, 241, 0.7)) drop-shadow(0 0 10px rgba(99, 102, 241, 0.4));
      }
      /* Sun glow in dark theme - warm yellow/orange */
      body.theme-dark #themeToggle .icon-sun {
        color: #fbbf24;
        filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6)) drop-shadow(0 0 8px rgba(251, 191, 36, 0.4));
        animation: sun-pulse 3s ease-in-out infinite;
      }
      body.theme-dark #themeToggle:hover .icon-sun {
        filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.8)) drop-shadow(0 0 14px rgba(251, 191, 36, 0.5));
      }
      @keyframes sun-pulse {
        0%, 100% { filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6)) drop-shadow(0 0 8px rgba(251, 191, 36, 0.4)); }
        50% { filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.8)) drop-shadow(0 0 12px rgba(251, 191, 36, 0.5)); }
      }
      /* Active state for icon buttons (e.g., Enrichment toggle) */
      .icon-btn.active { background:rgba(99,102,241,0.12); border-color:rgba(99,102,241,0.35); }
      body.theme-dark .icon-btn.active { background: rgba(255,255,255,0.12); }
      /* Bookmarked state for collection icons */
      .icon-btn.bookmarked { border-color: rgba(239,68,68,0.4); }
      .icon-btn.bookmarked svg { color: #ef4444; }
      body.theme-dark .icon-btn.bookmarked { border-color: rgba(248,113,113,0.5); }
      body.theme-dark .icon-btn.bookmarked svg { color: #f87171; }

      body.theme-dark .seg > button.active { background: rgba(255,255,255,0.08); }
      .btn.secondary.active {
        background: rgba(59,111,255,0.12);
        border-color: rgba(59,111,255,0.6);
        color: var(--accent);
      }
      body.theme-dark .btn.secondary.active {
        background: rgba(99,102,241,0.25);
        border-color: rgba(129,140,248,0.6);
        color: #c7d2ff;
      }
      .badge-gr {
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:2px 6px;
        font-size:11px;
        font-weight:600;
        color:#0f172a;
        background:linear-gradient(135deg, #a7f3d0, #6ee7b7);
        border-radius:999px;
      }
      /* layout + unified controls */
      html, body { height: 100%; }
      body { margin: 0; display: flex; flex-direction: column; }
      main { flex: 1; min-height: 0; }
      .input { height:36px; padding:0 12px; border:1px solid var(--border); border-radius:8px; background:var(--surface); color:var(--text); font-size:14px; box-sizing:border-box; }
      .input:focus { outline:none; box-shadow:0 0 0 2px rgba(99,102,241,.55); }
      select.input {
        appearance: none; -webkit-appearance: none; -moz-appearance: none;
        padding-right: 32px;
        background-image: url("data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0.5 3.85L6.65 10C6.695 10.048 6.749 10.086 6.809 10.112C6.87 10.138 6.934 10.152 7 10.152C7.066 10.152 7.13 10.138 7.191 10.112C7.251 10.086 7.305 10.048 7.35 10L13.5 3.85' stroke='%236b728e' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
        cursor: pointer;
      }
      body.theme-dark select.input {
        background-image: url("data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 14 14' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0.5 3.85L6.65 10C6.695 10.048 6.749 10.086 6.809 10.112C6.87 10.138 6.934 10.152 7 10.152C7.066 10.152 7.13 10.138 7.191 10.112C7.251 10.086 7.305 10.048 7.35 10L13.5 3.85' stroke='%23a6add6' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      }
      body.theme-dark .input:focus { box-shadow:0 0 0 2px rgba(129,140,248,.45); }
      .btn { height:36px; padding:0 12px; border:1px solid var(--border); border-radius:8px; background:var(--surface); color:var(--text); font-size:14px; cursor:pointer; box-sizing:border-box; }
      .btn:hover { background:var(--muted-surface); }
      .btn.icon-btn { width:36px; padding:0; display:flex; align-items:center; justify-content:center; }
      .range-input { background:transparent; border:1px solid transparent; }
      .range-input:hover { border-color:var(--border); }
      .range-input:focus { border-color:var(--accent); background:var(--surface); }
      .filter-group { border:1px solid var(--border); border-radius:10px; padding:2px 4px; background:var(--surface); }
      .filter-range { border:1px solid var(--border); }
      body.theme-dark .btn.primary { background: linear-gradient(180deg, #6366f1 0%, #4f46e5 100%); border-color: #6366f1; color: #fff; }
      body.theme-dark .btn.primary:hover { background: linear-gradient(180deg, #818cf8 0%, #6366f1 100%); }
      body.theme-dark .btn.secondary { background: rgba(99,102,241,0.12); border-color: rgba(99,102,241,0.35); color: #a5b4fc; }
      body.theme-dark .btn.secondary:hover { background: rgba(99,102,241,0.2); }
      .btn.primary { background:#4f46e5; color:#fff; border-color:#4f46e5; }
      .btn.primary:hover { background:#6366f1; }
      .seg { display:inline-flex; border:1px solid var(--border); border-radius:8px; overflow:hidden; }
      .seg > button { height:36px; width:36px; padding:0; margin:0; border:0; background:var(--surface); cursor:pointer; display:flex; align-items:center; justify-content:center; }
      .seg > button.active { background:var(--muted-surface); }
      .search-help-section { margin-top: 14px; }
      .search-help-section:first-of-type { margin-top: 0; }
      .search-help-section strong { display:block; font-size:13px; margin-bottom:6px; }
      .search-help-list { margin:0; padding-left:18px; line-height:1.5; }
      .search-help-list li { margin:4px 0; }
      .search-help-fields { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:6px 16px; font-size:13px; }
      .search-help-note { font-size:12px; color:var(--muted); margin-top:6px; }
      .bulk-toolbar { display:none; margin-bottom:12px; padding:10px 12px; border:1px dashed rgba(59,111,255,0.4); border-radius:10px; background:rgba(59,111,255,0.05); gap:12px; flex-wrap:wrap; align-items:center; }
      .bulk-toolbar.active { display:flex; }
      .bulk-toolbar .bulk-summary { font-weight:600; color:var(--accent); }
      .bulk-toolbar .bulk-actions { display:flex; gap:8px; flex-wrap:wrap; }
      .book { position:relative; }
      .book.bulk-selectable { cursor:pointer; padding-left: 48px; transition: padding 0.16s ease; }
      .book.bulk-selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,111,255,0.25); }
      .book .bulk-checkbox { position:absolute; left:16px; transform:none; width:18px; height:18px; accent-color: var(--accent); display:none; background:var(--surface); border-radius:4px; box-shadow:0 1px 2px rgba(15,23,42,0.12); }
      .book.bulk-selectable .bulk-checkbox { display:block; }
      details.goodreads-panel {
        border:1px solid var(--border);
        border-radius:12px;
        padding:8px 12px 12px;
        background:var(--surface);
        margin-top:12px;
      }
      details.goodreads-panel summary {
        font-weight:600;
        cursor:pointer;
        outline:none;
      }
      .goodreads-grid {
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap:8px 12px;
        margin-top:8px;
      }
    </style>
  </head>
  <body>
    <header class="sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200">
      <h1 class="flex items-center justify-center p-2">
        <img id="appIcon" src="" alt="–î–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞" data-i18n="app.title" data-i18n-attr="alt" width="48" height="48" style="display: none;" />
        <div id="iconFallback" style="width: 48px; height: 48px; background: linear-gradient(135deg, #4f46e5, #7c3aed, #f43f5e); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 20px;">üìö</div>
      </h1>
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="actions flex items-center gap-2">
          <input id="searchInput" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É‚Ä¶" data-i18n="header.search" data-i18n-attr="placeholder" class="input" style="width:16rem;" />
          <button id="searchHelpBtn" class="icon-btn" title="–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –ø–æ–∏—Å–∫—É" data-i18n="header.searchHelp" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="7" r="6.5"/><path d="M5.5 5.5C5.5 5.20333 5.58797 4.91332 5.7528 4.66665C5.91762 4.41997 6.15189 4.22771 6.42597 4.11418C6.70006 4.00065 7.00166 3.97094 7.29264 4.02882C7.58361 4.0867 7.85088 4.22956 8.06066 4.43934C8.27044 4.64912 8.4133 4.91639 8.47118 5.20737C8.52906 5.49834 8.49935 5.79994 8.38582 6.07403C8.27229 6.34812 8.08003 6.58238 7.83336 6.74721C7.58668 6.91203 7.29667 7 7 7V8"/><circle cx="7" cy="10.25" r="0.5" fill="currentColor"/></svg>
          </button>
          <button id="themeToggle" class="icon-btn" title="–¢—ë–º–Ω–∞—è —Ç–µ–º–∞" data-i18n="header.darkTheme" data-i18n-attr="title">
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12 10.48C10.8383 10.4729 9.69946 10.157 8.70014 9.56463C7.70083 8.97228 6.87703 8.12482 6.31321 7.10913C5.7494 6.09345 5.46585 4.94609 5.49164 3.78469C5.51743 2.6233 5.85164 1.48965 6.45999 0.5C4.85717 0.781382 3.41649 1.64934 2.41859 2.9348C1.42069 4.22026 0.937035 5.83116 1.06185 7.4537C1.18666 9.07624 1.91099 10.5942 3.09375 11.7119C4.27651 12.8297 5.83299 13.4671 7.45999 13.5C8.57312 13.5028 9.66809 13.218 10.6387 12.6731C11.6094 12.1282 12.4228 11.3418 13 10.39C12.6693 10.4446 12.3351 10.4747 12 10.48V10.48Z"/></svg>
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="7" r="3.25"/><path d="M7 0.5V1.5"/><path d="M7 12.5V13.5"/><path d="M13.5 7H12.5"/><path d="M1.5 7H0.5"/><path d="M11.6 2.3999L10.89 3.1099"/><path d="M3.10999 10.8899L2.39999 11.5999"/><path d="M11.6 11.5999L10.89 10.8899"/><path d="M3.10999 3.1099L2.39999 2.3999"/></svg>
          </button>
          <button id="exportBtn" class="icon-btn" title="–ë—ç–∫–∞–ø" data-i18n="header.backup" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7L7 10.5L10 7"/><path d="M7 10.5V3.5"/><circle cx="7" cy="7" r="6.5"/></svg>
          </button>
          <button id="importBtn" class="icon-btn" title="–ò–º–ø–æ—Ä—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏" data-i18n="header.importBackup" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7L7 3.5L10 7"/><path d="M7 3.5V10.5"/><circle cx="7" cy="7" r="6.5"/></svg>
          </button>
          <button id="csvImportBtn" class="icon-btn" title="–ò–º–ø–æ—Ä—Ç CSV/TSV" data-i18n="header.importCsv" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3.5 13.5H1.5C1.23478 13.5 0.98043 13.3946 0.792893 13.2071C0.605357 13.0196 0.5 12.7652 0.5 12.5V1.5C0.5 1.23478 0.605357 0.98043 0.792893 0.792893C0.98043 0.605357 1.23478 0.5 1.5 0.5H12.5C12.7652 0.5 13.0196 0.605357 13.2071 0.792893C13.3946 0.98043 13.5 1.23478 13.5 1.5V12.5C13.5 12.7652 13.3946 13.0196 13.2071 13.2071C13.0196 13.3946 12.7652 13.5 12.5 13.5H10.5"/><path d="M0.5 3.5H13.5"/><path d="M7 13.5V7"/><path d="M4.5 9.5L7 7L9.5 9.5"/></svg>
          </button>
          <button id="storageManagerBtn" class="icon-btn" title="–ú–µ—Å—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è" data-i18n="header.storage" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="0.55" y="0.5" width="3" height="13" rx="0.5"/><rect x="4.05" y="2.5" width="3" height="11" rx="0.5"/><path d="M10.3965 2.22633L8.45636 2.71187C8.18847 2.77891 8.02566 3.05041 8.0927 3.31829L10.5204 13.0191C10.5874 13.287 10.8589 13.4498 11.1268 13.3828L13.067 12.8973C13.3349 12.8302 13.4977 12.5587 13.4306 12.2908L11.003 2.58999C10.9359 2.32211 10.6644 2.15929 10.3965 2.22633Z"/><path d="M0.55 10H4.05"/><path d="M4.05 9H7.55"/><path d="M10.05 11L12.93 10.28"/></svg>
          </button>
          <button id="syncBtn" class="icon-btn" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è" data-i18n="header.sync" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9 0.5L11.5 3L9 5.5"/><path d="M0.5 6V4C0.5 3.73478 0.605357 3.48043 0.792893 3.29289C0.98043 3.10536 1.23478 3 1.5 3H11.5"/><path d="M5 13.5L2.5 11L5 8.5"/><path d="M13.5 8V10C13.5 10.2652 13.3946 10.5196 13.2071 10.7071C13.0196 10.8946 12.7652 11 12.5 11H2.5"/></svg>
          </button>
          <button id="openVocabManagerBtn" class="icon-btn" title="–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è" data-i18n="header.vocabs" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="1" cy="2.5" r="0.5" fill="currentColor"/><path d="M4.5 2.5H13.5"/><circle cx="1" cy="7" r="0.5" fill="currentColor"/><path d="M4.5 7H13.5"/><circle cx="1" cy="11.5" r="0.5" fill="currentColor"/><path d="M4.5 11.5H13.5"/></svg>
          </button>
          <button id="checkUpdatesBtn" class="icon-btn" title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è" data-i18n="header.checkUpdates" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 9L13 8.5L13.5 10.5"/><path d="M13 8.5C12.5558 9.75861 11.749 10.8576 10.6813 11.6584C9.61353 12.4592 8.33262 12.926 6.99999 13C5.7681 13.0002 4.566 12.6213 3.55697 11.9146C2.54794 11.2079 1.78088 10.2078 1.35999 9.05"/><path d="M3 5L1 5.5L0.5 3.5"/><path d="M1 5.5C1.84 3.2 4.42 1 7 1C8.23789 1.00348 9.4444 1.38976 10.4541 2.10588C11.4639 2.822 12.2274 3.8329 12.64 5"/></svg>
          </button>
          <button id="openHistoryBtn" class="icon-btn" title="–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π" data-i18n="header.history" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M0.5 7C0.5 8.28558 0.881218 9.54229 1.59545 10.6112C2.30968 11.6801 3.32484 12.5133 4.51256 13.0052C5.70028 13.4972 7.00721 13.6259 8.26809 13.3751C9.52896 13.1243 10.6872 12.5052 11.5962 11.5962C12.5052 10.6872 13.1243 9.52897 13.3751 8.26809C13.6259 7.00722 13.4972 5.70028 13.0052 4.51256C12.5132 3.32484 11.6801 2.30968 10.6112 1.59545C9.54229 0.881223 8.28558 0.500004 7 0.500004C5.13797 0.497944 3.34694 1.21436 2 2.5"/><path d="M2.5 0.5L2 2.5L4 3"/><path d="M7.00002 3.5V7.5L4.40002 8.8"/></svg>
          </button>
          <button id="openStatsBtn" class="icon-btn" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è" data-i18n="header.stats" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M0.5 13.5H13.5"/><path d="M4.5 13.5V0.5H0.5V13.5"/><path d="M8.5 13.5V6.5H4.5V13.5"/><path d="M12.5 13.5V3.5H8.5V13.5"/></svg>
          </button>
          <button id="openEnrichBtn" class="icon-btn" title="–û–±–æ–≥–∞—â–µ–Ω–∏–µ" data-i18n="header.enrich" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12.64 1.8699L11.8 4.3499C11.771 4.40726 11.7559 4.47063 11.7559 4.5349C11.7559 4.59917 11.771 4.66255 11.8 4.7199L13.37 6.8199C13.4151 6.88001 13.4424 6.95161 13.4487 7.0265C13.455 7.1014 13.4401 7.17655 13.4056 7.24335C13.3712 7.31015 13.3186 7.36589 13.254 7.40419C13.1893 7.44249 13.1152 7.4618 13.04 7.4599H10.42C10.3558 7.46179 10.2928 7.47804 10.2357 7.50746C10.1786 7.53688 10.1288 7.57872 10.09 7.6299L8.63003 9.7299C8.5872 9.79129 8.52802 9.83943 8.4592 9.86885C8.39038 9.89827 8.31468 9.90779 8.24072 9.89633C8.16676 9.88488 8.09749 9.85289 8.0408 9.80403C7.98411 9.75516 7.94226 9.69137 7.92003 9.6199L7.14002 7.1199C7.12223 7.05811 7.08904 7.00184 7.04357 6.95636C6.99809 6.91089 6.94182 6.8777 6.88003 6.8599L4.38003 6.0799C4.30856 6.05766 4.24477 6.01582 4.1959 5.95913C4.14703 5.90244 4.11505 5.83317 4.10359 5.75921C4.09213 5.68525 4.10166 5.60955 4.13108 5.54073C4.1605 5.47191 4.20864 5.41272 4.27003 5.3699L6.41002 3.8599C6.46121 3.82109 6.50305 3.7713 6.53247 3.71419C6.56189 3.65709 6.57814 3.59411 6.58002 3.5299V0.909903C6.58282 0.841088 6.60333 0.77416 6.63958 0.715598C6.67583 0.657037 6.72658 0.608827 6.78693 0.575637C6.84728 0.542446 6.91517 0.525399 6.98404 0.526147C7.0529 0.526894 7.12041 0.54541 7.18002 0.579903L9.28003 2.1499C9.33334 2.18693 9.39468 2.21077 9.459 2.21946C9.52333 2.22816 9.5888 2.22145 9.65002 2.1999L12.13 1.3599C12.2011 1.33491 12.2779 1.33052 12.3514 1.34724C12.4249 1.36397 12.4922 1.40113 12.5455 1.45443C12.5988 1.50774 12.636 1.57503 12.6527 1.64853C12.6694 1.72204 12.665 1.79878 12.64 1.8699V1.8699Z"/><path d="M7.04 6.95996L0.5 13.5"/></svg>
          </button>
          <button id="reloadBtn" class="icon-btn" title="–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–µ–∑ –∫—ç—à–∞" data-i18n="header.reload" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 9L13 8.5L13.5 10.5"/><path d="M13 8.5C12.5558 9.75861 11.749 10.8576 10.6813 11.6584C9.61353 12.4592 8.33262 12.926 6.99999 13C5.7681 13.0002 4.566 12.6213 3.55697 11.9146C2.54794 11.2079 1.78088 10.2078 1.35999 9.05"/><path d="M3 5L1 5.5L0.5 3.5"/><path d="M1 5.5C1.84 3.2 4.42 1 7 1C8.23789 1.00348 9.4444 1.38976 10.4541 2.10588C11.4639 2.822 12.2274 3.8329 12.64 5"/></svg>
          </button>
          <button id="openSettingsBtn" class="icon-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" data-i18n="header.settings" data-i18n-attr="title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="2" cy="2" r="1.5"/><path d="M3.5 2H13.5"/><circle cx="7" cy="7" r="1.5"/><path d="M0.5 7H5.5"/><path d="M8.5 7H13.5"/><circle cx="12" cy="12" r="1.5"/><path d="M10.5 12H0.5"/></svg>
          </button>
        </div>
      </div>
    </header>
    <main class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-[380px,1fr] gap-5">
      <section id="libraryView" class="card">
        <div class="form-toggle-header" id="formToggleHeader">
          <h3 id="formTitle" data-i18n="form.addBook">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</h3>
          <svg class="form-toggle-icon collapsed" id="formToggleIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M3.5 5.25L7 8.75L10.5 5.25"/></svg>
        </div>
        <div class="form-content collapsed" id="formContent">
        <label data-i18n="form.title">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input id="titleInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –í–æ–π–Ω–∞ –∏ –º–∏—Ä" data-i18n="form.titlePlaceholder" data-i18n-attr="placeholder" class="input w-full" />
        <label data-i18n="form.authors">–ê–≤—Ç–æ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
        <input id="authorsInput" type="text" placeholder="–ê–≤—Ç–æ—Ä1, –ê–≤—Ç–æ—Ä2" data-i18n="form.authorsPlaceholder" data-i18n-attr="placeholder" class="input w-full" />
        <label data-i18n="form.cover">–û–±–ª–æ–∂–∫–∞</label>
        <div class="row" style="gap:8px; align-items:center;">
          <button id="chooseCoverBtn" class="btn" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="0.51" y="0.5" width="13" height="13" rx="1"/><circle cx="9.25" cy="4.75" r="1.75"/><path d="M9.4 13.4999C9.07801 11.7849 8.15715 10.2401 6.80173 9.14113C5.44632 8.04214 3.74452 7.46048 2 7.49993C1.49668 7.49858 0.994381 7.54546 0.5 7.63993"/><path d="M13.5 9.91002C12.6946 9.63803 11.8501 9.49954 11 9.50002C9.92394 9.49768 8.85877 9.71548 7.87 10.14"/></svg>
            <span data-i18n="form.chooseFile">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª‚Ä¶</span>
          </button>
          <button id="coverSearchBtn" class="btn secondary" type="button" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="7" r="6.5"/><path d="M0.5 7H13.5"/><path d="M9.5 7C9.3772 9.37699 8.50168 11.6533 7 13.5C5.49832 11.6533 4.6228 9.37699 4.5 7C4.6228 4.62301 5.49832 2.34665 7 0.5C8.50168 2.34665 9.3772 4.62301 9.5 7V7Z"/></svg>
            <span data-i18n="form.findOnline">–ù–∞–π—Ç–∏ –æ–Ω–ª–∞–π–Ω‚Ä¶</span>
          </button>
          <span id="coverFileLabel" class="text-xs text-slate-500" style="margin-left:auto;" data-i18n="form.notSelected">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span>
        </div>
        <div class="row" style="margin-top:8px; gap:8px;">
          <input id="coverUrlInput" type="url" placeholder="https://example.com/cover.jpg" data-i18n="form.coverUrlPlaceholder" data-i18n-attr="placeholder" class="input" style="flex:1;" />
          <button id="loadCoverBtn" class="btn" data-i18n="form.loadCover">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
        <img id="coverPreview" class="cover-preview dropzone" alt="–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" />
        <label style="margin-top:12px;" data-i18n="form.storage">–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</label>
        <div class="row" style="gap:8px; align-items:center;">
          <select id="storageSelect" class="input" style="flex:1; min-width:0;">
            <option value="">‚Äî</option>
          </select>
          <button id="storageQuickAddBtn" type="button" class="btn secondary" style="white-space:nowrap; display:flex; align-items:center; gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M7 0.540039V13.54"/><path d="M0.5 7H13.5"/></svg>
            <span data-i18n="form.addStorage">–î–æ–±–∞–≤–∏—Ç—å‚Ä¶</span>
          </button>
        </div>
        <div class="row" style="margin-top:12px; gap:12px;">
          <button id="saveBtn" class="btn primary" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8L6.05 9.64C6.10506 9.68534 6.16952 9.71784 6.23872 9.73514C6.30791 9.75244 6.38009 9.7541 6.45 9.74C6.52058 9.72676 6.58749 9.69847 6.64616 9.65706C6.70483 9.61564 6.75389 9.56207 6.79 9.5L10 4"/><circle cx="7" cy="7" r="6.5"/></svg>
            <span data-i18n="form.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
          </button>
          <button id="resetBtn" class="btn" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
            <span data-i18n="form.reset">–°–±—Ä–æ—Å–∏—Ç—å</span>
          </button>
        </div>
        <div style="margin-top:8px;">
          <button id="openCreateModalBtn" class="btn secondary" style="width:100%; display:flex; align-items:center; justify-content:center; gap:6px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="7" r="6.5"/><path d="M7 7V10.5"/><circle cx="7" cy="4.5" r="0.5" fill="currentColor"/></svg>
            <span data-i18n="form.advancedForm">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞</span>
          </button>
        </div>
        </div><!-- /form-content -->
      </section>

      <section id="listSection" class="card" style="min-height:0; min-width:0; display:flex; flex-direction:column;">
        <!-- Row 1: View toggle, Collections, Saved searches, Sort -->
        <div class="row" style="margin-bottom:6px; align-items:center; gap:6px; flex-wrap:wrap;">
          <div class="seg" role="group" aria-label="–í–∏–¥">
            <button id="btnViewGrid" type="button" class="active" aria-pressed="true" title="–°–µ—Ç–∫–∞" data-i18n="list.grid" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="0.5" y="0.5" width="13" height="13" rx="1"/><path d="M7 0.5V13.5"/><path d="M0.5 7H13.5"/></svg>
            </button>
            <button id="btnViewList" type="button" aria-pressed="false" title="–°–ø–∏—Å–æ–∫" data-i18n="list.listView" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="1" cy="2.5" r="0.5" fill="currentColor"/><path d="M4.5 2.5H13.5"/><circle cx="1" cy="7" r="0.5" fill="currentColor"/><path d="M4.5 7H13.5"/><circle cx="1" cy="11.5" r="0.5" fill="currentColor"/><path d="M4.5 11.5H13.5"/></svg>
            </button>
          </div>
          <!-- Collections group -->
          <div class="filter-group" style="display:flex; align-items:center; gap:3px;">
            <select id="collectionSelect" class="input" style="width:auto; min-width:7rem; font-size:13px; height:30px;">
              <option value="" data-i18n="filters.collections">–ö–æ–ª–ª–µ–∫—Ü–∏–∏‚Ä¶</option>
            </select>
            <button id="createCollectionBtn" type="button" class="btn icon-btn" title="–°–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é" data-i18n="filters.createCollectionTitle" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M7 0.540039V13.54"/><path d="M0.5 7H13.5"/></svg>
            </button>
            <button id="renameCollectionBtn" type="button" class="btn icon-btn" title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é" data-i18n="filters.renameCollectionTitle" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10.5 1.5L12.5 3.5L4.5 11.5L1.5 12.5L2.5 9.5L10.5 1.5Z"/></svg>
            </button>
            <button id="deleteCollectionBtn" type="button" class="btn icon-btn" title="–£–¥–∞–ª–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é" data-i18n="filters.deleteCollectionTitle" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 3.5H13"/><path d="M2.5 3.5H11.5V12.5C11.5 12.7652 11.3946 13.0196 11.2071 13.2071C11.0196 13.3946 10.7652 13.5 10.5 13.5H3.5C3.23478 13.5 2.98043 13.3946 2.79289 13.2071C2.60536 13.0196 2.5 12.7652 2.5 12.5V3.5Z"/><path d="M4.5 3.5V3C4.5 2.33696 4.76339 1.70107 5.23223 1.23223C5.70107 0.763392 6.33696 0.5 7 0.5C7.66304 0.5 8.29893 0.763392 8.76777 1.23223C9.23661 1.70107 9.5 2.33696 9.5 3V3.5"/><path d="M5.5 5.5V11"/><path d="M8.5 5.5V11"/></svg>
            </button>
          </div>
          <!-- Saved searches group -->
          <div class="filter-group" style="display:flex; align-items:center; gap:3px;">
            <select id="filterPresetSelect" class="input" style="width:auto; min-width:8rem; font-size:13px; height:30px;">
              <option value="" data-i18n="filters.savedSearches">–ü–æ–∏—Å–∫–∏‚Ä¶</option>
            </select>
            <button id="savePresetBtn" type="button" class="btn icon-btn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫" data-i18n="filters.savePresetTitle" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 12.5C13.5 12.7652 13.3946 13.0196 13.2071 13.2071C13.0196 13.3946 12.7652 13.5 12.5 13.5H1.5C1.23478 13.5 0.98043 13.3946 0.792893 13.2071C0.605357 13.0196 0.5 12.7652 0.5 12.5V3.5L3.5 0.5H12.5C12.7652 0.5 13.0196 0.605357 13.2071 0.792893C13.3946 0.98043 13.5 1.23478 13.5 1.5V12.5Z"/><rect x="3.5" y="8.5" width="7" height="5"/><rect x="4.5" y="0.5" width="6" height="4"/></svg>
            </button>
            <button id="deletePresetBtn" type="button" class="btn icon-btn" title="–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫" data-i18n="filters.deletePresetTitle" data-i18n-attr="title">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 3.5H13"/><path d="M2.5 3.5H11.5V12.5C11.5 12.7652 11.3946 13.0196 11.2071 13.2071C11.0196 13.3946 10.7652 13.5 10.5 13.5H3.5C3.23478 13.5 2.98043 13.3946 2.79289 13.2071C2.60536 13.0196 2.5 12.7652 2.5 12.5V3.5Z"/><path d="M4.5 3.5V3C4.5 2.33696 4.76339 1.70107 5.23223 1.23223C5.70107 0.763392 6.33696 0.5 7 0.5C7.66304 0.5 8.29893 0.763392 8.76777 1.23223C9.23661 1.70107 9.5 2.33696 9.5 3V3.5"/><path d="M5.5 5.5V11"/><path d="M8.5 5.5V11"/></svg>
            </button>
          </div>
          <!-- Spacer -->
          <div style="flex:1;"></div>
          <!-- Sort -->
          <div style="display:flex; align-items:center; gap:6px;">
            <label for="sortSelect" style="margin:0; color:var(--muted); font-size:12px;" data-i18n="list.sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
            <select id="sortSelect" class="input" style="width:auto; font-size:13px; height:30px;">
              <option value="title" data-i18n="list.sortTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</option>
              <option value="author" data-i18n="list.sortAuthor">–ê–≤—Ç–æ—Ä</option>
              <option value="date" data-i18n="list.sortDate">–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
              <option value="goodreads" data-i18n="list.sortGoodreads">–†–µ–π—Ç–∏–Ω–≥ Goodreads</option>
              <option value="series" data-i18n="list.sortSeries">–°–µ—Ä–∏—è</option>
            </select>
          </div>
        </div>
        <!-- Inline save input (appears when saving) -->
        <div id="collectionSaveInline" class="row" style="display:none; align-items:center; gap:6px; width:100%; margin-bottom:6px;">
          <input id="collectionNameInput" class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏" data-i18n="filters.collectionName" data-i18n-attr="placeholder" style="width:18rem;" />
          <button id="collectionSaveConfirmBtn" type="button" class="btn" data-i18n="actions.ok">–û–∫</button>
          <button id="collectionSaveCancelBtn" type="button" class="btn" data-i18n="actions.cancel">–û—Ç–º–µ–Ω–∞</button>
        </div>
        <!-- Row 2: Filters and actions -->
        <div id="filtersBar" style="display:flex; align-items:center; gap:6px; margin-bottom:8px; flex-wrap:wrap;">
            <select id="filterAuthor" class="input" style="width:auto; min-width:6rem; max-width:7rem; flex-shrink:1;">
              <option value="">–ê–≤—Ç–æ—Ä‚Ä¶</option>
            </select>
            <input id="filterGenres" class="input" type="text" placeholder="–ñ–∞–Ω—Ä—ã" data-i18n="filters.genresShort" data-i18n-attr="placeholder" style="width:5rem; flex-shrink:1;" />
            <input id="filterTags" class="input" type="text" placeholder="–¢–µ–≥–∏" data-i18n="filters.tagsShort" data-i18n-attr="placeholder" style="width:5rem; flex-shrink:1;" />
            <select id="filterFormat" class="input" style="width:auto; max-width:6rem; flex-shrink:1;">
              <option value="" data-i18n="filters.format">–§–æ—Ä–º–∞—Ç‚Ä¶</option>
              <option value="paper" data-i18n="format.paper">–ë—É–º–∞–∂–Ω–∞—è</option>
              <option value="ebook" data-i18n="format.ebook">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è</option>
              <option value="audiobook" data-i18n="format.audiobook">–ê—É–¥–∏–æ</option>
            </select>
            <select id="filterReadingStatus" class="input" style="width:auto; max-width:8rem; flex-shrink:1;">
              <option value="" data-i18n="filters.readingStatus">–°—Ç–∞—Ç—É—Å‚Ä¶</option>
              <option value="want_to_read" data-i18n="readingStatus.wantToRead">üîñ –•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å</option>
              <option value="reading" data-i18n="readingStatus.reading">üìñ –ß–∏—Ç–∞—é</option>
              <option value="finished" data-i18n="readingStatus.finished">‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
              <option value="re_reading" data-i18n="readingStatus.reReading">üîÅ –ü–µ—Ä–µ—á–∏—Ç—ã–≤–∞—é</option>
              <option value="abandoned" data-i18n="readingStatus.abandoned">‚ùå –ë—Ä–æ—à–µ–Ω–æ</option>
              <option value="on_hold" data-i18n="readingStatus.onHold">‚è∏Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ</option>
              <option value="no_status" data-i18n="readingStatus.noStatus">‚Äî  –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞</option>
            </select>
            <!-- Year range group -->
            <div class="filter-range" style="display:flex; align-items:center; gap:2px; background:var(--muted-surface); padding:2px 4px; border-radius:6px; flex-shrink:0;">
              <span style="font-size:11px; color:var(--muted); font-weight:500;" data-i18n="filters.yearLabel">–ì–æ–¥</span>
              <input id="filterYearFrom" class="input range-input" type="number" placeholder="1900" style="width:3rem; height:24px; font-size:11px; padding:0 4px;" />
              <span style="color:var(--muted); font-size:10px;">‚Äî</span>
              <input id="filterYearTo" class="input range-input" type="number" placeholder="2025" style="width:3rem; height:24px; font-size:11px; padding:0 4px;" />
            </div>
            <!-- GR range group -->
            <div class="filter-range" style="display:flex; align-items:center; gap:2px; background:var(--muted-surface); padding:2px 4px; border-radius:6px; flex-shrink:0;">
              <span style="font-size:11px; color:var(--muted); font-weight:500;">GR</span>
              <input id="filterGoodreadsFrom" class="input range-input" type="number" step="0.1" placeholder="0" style="width:2.5rem; height:24px; font-size:11px; padding:0 4px;" />
              <span style="color:var(--muted); font-size:10px;">‚Äî</span>
              <input id="filterGoodreadsTo" class="input range-input" type="number" step="0.1" placeholder="5" style="width:2.5rem; height:24px; font-size:11px; padding:0 4px;" />
            </div>
            <!-- Right side actions -->
            <div style="margin-left:auto; display:flex; align-items:center; gap:4px; flex-shrink:0;">
              <button id="btnClearFilters" class="btn" type="button" title="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã" data-i18n="filters.clearTitle" data-i18n-attr="title" style="display:flex; align-items:center; gap:6px; font-size:13px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
                <span data-i18n="filters.clear">–°–±—Ä–æ—Å–∏—Ç—å</span>
              </button>
              <button id="bulkEditToggle" class="btn icon-btn" type="button" title="–ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" data-i18n="filters.bulkEdit" data-i18n-attr="title">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M7.47003 6.90008C7.3217 6.96449 7.16173 6.99772 7.00003 6.99772C6.83832 6.99772 6.67835 6.96449 6.53003 6.90008L0.830026 4.26008C0.737468 4.2134 0.659684 4.14194 0.605338 4.05366C0.550992 3.96538 0.522217 3.86375 0.522217 3.76008C0.522217 3.65642 0.550992 3.55479 0.605338 3.46651C0.659684 3.37823 0.737468 3.30677 0.830026 3.26008L6.53003 0.600083C6.67835 0.535676 6.83832 0.502441 7.00003 0.502441C7.16173 0.502441 7.3217 0.535676 7.47003 0.600083L13.17 3.24008C13.2626 3.28677 13.3404 3.35823 13.3947 3.44651C13.4491 3.53479 13.4778 3.63642 13.4778 3.74008C13.4778 3.84375 13.4491 3.94538 13.3947 4.03366C13.3404 4.12194 13.2626 4.1934 13.17 4.24008L7.47003 6.90008Z"/>
                  <path d="M13.5 7.3501L7.4 10.1601C7.26972 10.2195 7.12819 10.2503 6.985 10.2503C6.84181 10.2503 6.70028 10.2195 6.57 10.1601L0.5 7.3501"/>
                  <path d="M13.5 10.6001L7.4 13.4101C7.26972 13.4695 7.12819 13.5003 6.985 13.5003C6.84181 13.5003 6.70028 13.4695 6.57 13.4101L0.5 10.6001"/>
                </svg>
              </button>
            </div>
        </div>
        <div id="bulkToolbar" class="bulk-toolbar">
          <span id="bulkSelectedCounter" class="bulk-summary" data-i18n-template="bulk.selected">–í—ã–±—Ä–∞–Ω–æ: 0</span>
          <div class="bulk-actions">
            <button id="bulkAddTagsBtn" type="button" class="btn secondary" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.25 9.35994L9.36 13.2499C9.21937 13.3904 9.02875 13.4693 8.83 13.4693C8.63125 13.4693 8.44062 13.3904 8.3 13.2499L1.79 6.73994C1.75121 6.70286 1.7212 6.65757 1.70217 6.6074C1.68313 6.55722 1.67556 6.50343 1.68 6.44994L2.27 2.60994C2.27688 2.52206 2.31491 2.43952 2.37724 2.37719C2.43957 2.31485 2.52211 2.27682 2.61 2.26994L6.45 1.67994C6.50348 1.67551 6.55728 1.68308 6.60745 1.70211C6.65763 1.72114 6.70291 1.75115 6.74 1.78994L13.25 8.29994C13.3904 8.44057 13.4693 8.63119 13.4693 8.82994C13.4693 9.0287 13.3904 9.21932 13.25 9.35994V9.35994Z"/><path d="M4.03 4.03003L0.529999 0.530029"/></svg>
              <span data-i18n="bulk.addTags">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏</span>
            </button>
            <button id="bulkRemoveTagsBtn" type="button" class="btn" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.25 9.35994L9.36 13.2499C9.21937 13.3904 9.02875 13.4693 8.83 13.4693C8.63125 13.4693 8.44062 13.3904 8.3 13.2499L1.79 6.73994C1.75121 6.70286 1.7212 6.65757 1.70217 6.6074C1.68313 6.55722 1.67556 6.50343 1.68 6.44994L2.27 2.60994C2.27688 2.52206 2.31491 2.43952 2.37724 2.37719C2.43957 2.31485 2.52211 2.27682 2.61 2.26994L6.45 1.67994C6.50348 1.67551 6.55728 1.68308 6.60745 1.70211C6.65763 1.72114 6.70291 1.75115 6.74 1.78994L13.25 8.29994C13.3904 8.44057 13.4693 8.63119 13.4693 8.82994C13.4693 9.0287 13.3904 9.21932 13.25 9.35994V9.35994Z"/><path d="M4.03 4.03003L0.529999 0.530029"/></svg>
              <span data-i18n="bulk.removeTags">–£–¥–∞–ª–∏—Ç—å —Ç–µ–≥–∏</span>
            </button>
            <button id="bulkAddToCollectionsBtn" type="button" class="btn secondary" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 13.5L7 9.5L3 13.5V1.5C3 1.23478 3.10536 0.98043 3.29289 0.792893C3.48043 0.605357 3.73478 0.5 4 0.5H10C10.2652 0.5 10.5196 0.605357 10.7071 0.792893C10.8946 0.98043 11 1.23478 11 1.5V13.5Z"/></svg>
              <span data-i18n="bulk.addToCollections">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏‚Ä¶</span>
            </button>
            <button id="bulkRemoveFromCollectionsBtn" type="button" class="btn" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 13.5L7 9.5L3 13.5V1.5C3 1.23478 3.10536 0.98043 3.29289 0.792893C3.48043 0.605357 3.73478 0.5 4 0.5H10C10.2652 0.5 10.5196 0.605357 10.7071 0.792893C10.8946 0.98043 11 1.23478 11 1.5V13.5Z"/></svg>
              <span data-i18n="bulk.removeFromCollections">–£–±—Ä–∞—Ç—å –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–π‚Ä¶</span>
            </button>
            <button id="bulkSetStorageBtn" type="button" class="btn secondary" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="0.55" y="0.5" width="3" height="13" rx="0.5"/><rect x="4.05" y="2.5" width="3" height="11" rx="0.5"/><path d="M10.3965 2.22633L8.45636 2.71187C8.18847 2.77891 8.02566 3.05041 8.0927 3.31829L10.5204 13.0191C10.5874 13.287 10.8589 13.4498 11.1268 13.3828L13.067 12.8973C13.3349 12.8302 13.4977 12.5587 13.4306 12.2908L11.003 2.58999C10.9359 2.32211 10.6644 2.15929 10.3965 2.22633Z"/><path d="M0.55 10H4.05"/><path d="M4.05 9H7.55"/><path d="M10.05 11L12.93 10.28"/></svg>
              <span data-i18n="bulk.setStorage">–ù–∞–∑–Ω–∞—á–∏—Ç—å –º–µ—Å—Ç–æ‚Ä¶</span>
            </button>
            <button id="bulkClearSelectionBtn" type="button" class="btn" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
              <span data-i18n="bulk.clearSelection">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</span>
            </button>
            <button id="bulkExitBtn" type="button" class="btn" style="display:flex; align-items:center; gap:8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
              <span data-i18n="bulk.exit">–í—ã–π—Ç–∏</span>
            </button>
          </div>
        </div>
        <div id="listViewport" style="flex:1; min-height:0; overflow-y: auto; padding-right: 8px;">
          <div id="list" class="list"></div>
        </div>
        <div id="empty" class="empty" style="display:none;" data-i18n="app.noBooks">–ü–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</div>
      </section>
      <section id="enrichView" class="card" style="display:none;">
        <h3 data-i18n="enrich.title">–û–±–æ–≥–∞—â–µ–Ω–∏–µ ISBN (CSV ‚Üí OpenAI ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞)</h3>
        <div class="row" style="margin:8px 0; gap:8px; align-items:flex-end;">
          <div>
            <label data-i18n="enrich.csvFile">CSV —Ñ–∞–π–ª</label>
            <input id="csvInput" type="file" accept=".csv,text/csv" />
          </div>
          <button id="parseCsvBtn" data-i18n="enrich.load">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
        <div id="mappingArea" style="display:none; margin:8px 0;">
          <div style="font-size:12px; color:var(--muted); margin-bottom:6px;" data-i18n="enrich.mapColumns">–°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫–∏</div>
          <div class="row" style="gap:8px;">
            <div><label data-i18n="enrich.mapTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</label><select id="mapTitle"></select></div>
            <div><label data-i18n="enrich.mapAuthors">–ê–≤—Ç–æ—Ä—ã</label><select id="mapAuthors"></select></div>
            <div><label data-i18n="enrich.mapPublisher">–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</label><select id="mapPublisher"></select></div>
            <div><label data-i18n="enrich.mapYear">–ì–æ–¥</label><select id="mapYear"></select></div>
          </div>
          <div class="row" style="gap:8px; align-items:center; margin-top:6px;">
            <input id="csvHeaderless" type="checkbox" />
            <label for="csvHeaderless" style="margin:0;" data-i18n="enrich.noHeader">CSV –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –¥–∞–Ω–Ω—ã–µ)</label>
          </div>
          <div class="row" style="margin-top:8px;">
            <button id="startEnrichBtn" class="primary" data-i18n="enrich.start">–ù–∞—á–∞—Ç—å</button>
            <button id="stopEnrichBtn" data-i18n="enrich.pause">–ü–∞—É–∑–∞</button>
            <label style="display:flex; align-items:center; gap:6px; margin-left:8px;">
              <input id="enrichIgnoreCache" type="checkbox" /> <span data-i18n="enrich.ignoreCache">–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à (OpenAI)</span>
            </label>
            <button id="clearAiCacheBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à OpenAI —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤" style="margin-left:auto;" data-i18n="enrich.clearCache">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
          </div>
        </div>
        <div id="enrichList" style="margin-top:10px; display:flex; flex-direction:column; gap:8px;"></div>
        <div class="row" style="margin-top:10px;">
          <button id="exportCsvBtn" data-i18n="enrich.exportCsv">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
        </div>
      </section>
      <section id="historyView" class="card" style="display:none; grid-column: 1 / -1;">
        <div class="history-view">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;" data-i18n="history.title">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
            <div style="display:flex; gap:8px;">
              <button id="historyReloadBtn" class="btn secondary" type="button" data-i18n="history.reload">–û–±–Ω–æ–≤–∏—Ç—å</button>
              <button id="historyExportBtn" class="btn secondary" type="button" data-i18n="history.export">–≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
          </div>
          <div class="history-controls">
            <select id="historyActionFilter" class="input" style="width:auto; min-width:12rem;">
              <option value="all" data-i18n="history.all">–í—Å–µ —Å–æ–±—ã—Ç–∏—è</option>
              <option value="book" data-i18n="history.books">–ö–Ω–∏–≥–∏</option>
              <option value="storage" data-i18n="history.storages">–ú–µ—Å—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è</option>
              <option value="sync" data-i18n="history.sync">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</option>
              <option value="backup" data-i18n="history.backups">–ë—ç–∫–∞–ø—ã</option>
              <option value="activity" data-i18n="history.activity">–ñ—É—Ä–Ω–∞–ª</option>
            </select>
            <input id="historySearchInput" class="input" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∂—É—Ä–Ω–∞–ª—É" data-i18n="history.searchPlaceholder" data-i18n-attr="placeholder" style="flex:1 1 240px; min-width:14rem;" />
          </div>
          <div class="history-list-wrapper">
            <div id="historyEmpty" class="history-empty" style="display:none;" data-i18n="history.empty">–ó–∞–ø–∏—Å–µ–π –∂—É—Ä–Ω–∞–ª–∞ –ø–æ–∫–∞ –Ω–µ—Ç.</div>
            <div id="historyList" class="history-list"></div>
            <div class="history-loadmore">
              <button id="historyLoadMoreBtn" class="btn secondary" type="button" style="display:none;" data-i18n="history.loadMore">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
            </div>
          </div>
        </div>
      </section>
      <section id="statsView" class="card" style="display:none; grid-column: 1 / -1;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <h3 style="margin:0;" data-i18n="stats.title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è</h3>
        </div>
        <!-- Stats by Status -->
        <div style="border:1px solid var(--border); border-radius:12px; padding:16px; background:var(--surface); margin-bottom:16px;">
          <h4 style="margin:0 0 12px 0; font-size:15px; font-weight:600;" data-i18n="stats.byStatus">–ü–æ —Å—Ç–∞—Ç—É—Å–∞–º</h4>
          <div style="font-size:12px; color:var(--muted); margin-bottom:12px;" data-i18n="stats.clickToExpand">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–Ω–∏–≥–∏</div>
          <div id="statsByStatus" style="display:flex; flex-direction:column; gap:8px;"></div>
        </div>
        <!-- Stats by Year (collapsible) -->
        <details style="border:1px solid var(--border); border-radius:12px; background:var(--surface);">
          <summary style="padding:16px; cursor:pointer; font-size:15px; font-weight:600; display:flex; align-items:center; gap:8px;">
            <span data-i18n="stats.byYear">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ø–æ –≥–æ–¥–∞–º</span>
          </summary>
          <div style="padding:0 16px 16px 16px;">
            <div id="statsByYear" style="display:flex; flex-direction:column; gap:8px;"></div>
          </div>
        </details>
      </section>
    </main>

    <!-- search help modal -->
    <div id="searchHelpModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(620px, 96vw); max-height:100%; overflow:auto; background: var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow: var(--shadow); padding:18px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="searchHelp.title">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –ø–æ–∏—Å–∫—É</h3>
          <button id="searchHelpCloseBtn" data-i18n="modal.close">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="search-help-content" style="margin-top:12px; font-size:13px;">
          <div class="search-help-section">
            <strong data-i18n="searchHelp.quickSearch">–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫</strong>
            <ul class="search-help-list">
              <li data-i18n="searchHelp.quickSearchDesc">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—Ä–æ—Å –∏—â–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, –∞–≤—Ç–æ—Ä–∞—Ö, —Ç–µ–≥–∞—Ö, –∂–∞–Ω—Ä–∞—Ö, –∑–∞–º–µ—Ç–∫–∞—Ö, –∏–∑–¥–∞—Ç–µ–ª–µ, —Å–µ—Ä–∏–∏, —Ñ–æ—Ä–º–∞—Ç–µ –∏ —è–∑—ã–∫–µ.</li>
              <li><span data-i18n="searchHelp.caseNote">–†–µ–≥–∏—Å—Ç—Ä—ã –Ω–µ –≤–∞–∂–Ω—ã. –ß—Ç–æ–±—ã –∏—Å–∫–∞—Ç—å —Ç–æ—á–Ω—É—é —Ñ—Ä–∞–∑—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–≤—ã—á–∫–∏:</span> <code data-i18n="searchHelp.codeQuote">"–≤–æ–π–Ω–∞ –∏ –º–∏—Ä"</code></li>
            </ul>
          </div>
          <div class="search-help-section">
            <strong data-i18n="searchHelp.logicalOps">–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã</strong>
            <ul class="search-help-list">
              <li><code data-i18n="searchHelp.codeWords">—Å–ª–æ–≤–æ1 —Å–ª–æ–≤–æ2</code> <span data-i18n="searchHelp.logicalAnd">‚Äî —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç —Ñ—Ä–∞–∑—É, –∞ –µ—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç, –æ–±–∞ —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è (–Ω–µ—è–≤–Ω—ã–π AND).</span></li>
              <li><code>term1 AND term2</code> <span data-i18n="searchHelp.logicalAndExplicit">‚Äî –Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏, –≥–¥–µ –µ—Å—Ç—å –æ–±–∞ —É—Å–ª–æ–≤–∏—è.</span></li>
              <li><code>term1 OR term2</code> <span data-i18n="searchHelp.logicalOr">‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ö–æ—Ç—è –±—ã —Å –æ–¥–Ω–∏–º —É—Å–ª–æ–≤–∏–µ–º.</span></li>
              <li><code>NOT term</code> <span data-i18n="searchHelp.logicalNot">‚Äî –∏—Å–∫–ª—é—á–∏—Ç—å –∫–Ω–∏–≥–∏, –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Ç–µ—Ä–º–∏–Ω.</span></li>
              <li><span data-i18n="searchHelp.logicalBrackets">–°–∫–æ–±–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:</span> <code data-i18n="searchHelp.codeBrackets">(—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ OR –∫–æ—Å–º–æ—Å) AND NOT tag:–ø—Ä–æ—á–∏—Ç–∞–Ω–æ</code></li>
            </ul>
          </div>
          <div class="search-help-section">
            <strong data-i18n="searchHelp.fieldFilters">–§–∏–ª—å—Ç—Ä—ã –ø–æ –ø–æ–ª—è–º</strong>
            <div class="search-help-fields">
              <div><code>title:</code> <span data-i18n="searchHelp.fieldTitle">–Ω–∞–∑–≤–∞–Ω–∏–µ</span></div>
              <div><code>author:</code>, <code>authors:</code> <span data-i18n="searchHelp.fieldAuthor">–∞–≤—Ç–æ—Ä—ã</span></div>
              <div><code>tag:</code>, <code>tags:</code> <span data-i18n="searchHelp.fieldTag">—Ç–µ–≥–∏</span></div>
              <div><code>genre:</code>, <code>genres:</code> <span data-i18n="searchHelp.fieldGenre">–∂–∞–Ω—Ä—ã</span></div>
              <div><code>series:</code> <span data-i18n="searchHelp.fieldSeries">—Å–µ—Ä–∏—è</span></div>
              <div><code>publisher:</code> <span data-i18n="searchHelp.fieldPublisher">–∏–∑–¥–∞—Ç–µ–ª—å</span></div>
              <div><code>notes:</code> <span data-i18n="searchHelp.fieldNotes">–∑–∞–º–µ—Ç–∫–∏</span></div>
              <div><code>format:</code> <span data-i18n="searchHelp.fieldFormat">—Ñ–æ—Ä–º–∞—Ç</span></div>
              <div><code>language:</code> <span data-i18n="searchHelp.fieldLanguage">—è–∑—ã–∫</span></div>
              <div><code>year:</code> <span data-i18n="searchHelp.fieldYear">–≥–æ–¥ –∏–∑–¥–∞–Ω–∏—è</span></div>
              <div><code>rating:</code> <span data-i18n="searchHelp.fieldRating">–æ—Ü–µ–Ω–∫–∞</span></div>
              <div><code>original:</code> <span data-i18n="searchHelp.fieldOriginal">–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (EN)</span></div>
              <div><code>originalauthors:</code> <span data-i18n="searchHelp.fieldOriginalAuthors">–∞–≤—Ç–æ—Ä—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</span></div>
              <div><code>goodreads:</code>, <code>gr:</code> <span data-i18n="searchHelp.fieldGoodreads">—Ä–µ–π—Ç–∏–Ω–≥ Goodreads</span></div>
            </div>
            <div class="search-help-note"><span data-i18n="searchHelp.numericNote">–î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:</span> <code>year:&gt;=2000</code>, <code>rating:&lt;4.5</code>, <code>goodreads:&gt;=4</code>.</div>
          </div>
          <div class="search-help-section">
            <strong data-i18n="searchHelp.examples">–ü—Ä–∏–º–µ—Ä—ã</strong>
            <ul class="search-help-list">
              <li><code data-i18n="searchHelp.codeExample1">author:–ª–µ–º AND NOT tag:–ø—Ä–æ—á–∏—Ç–∞–Ω–æ</code> <span data-i18n="searchHelp.example1">‚Äî –∫–Ω–∏–≥–∏ –õ–µ–º–∞, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ.</span></li>
              <li><code data-i18n="searchHelp.codeExample2">(genre:—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ OR tag:–∫–æ—Å–º–æ—Å) AND year:&gt;=2000</code> <span data-i18n="searchHelp.example2">‚Äî —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ –∏–ª–∏ –∫–Ω–∏–≥–∏ –æ –∫–æ—Å–º–æ—Å–µ, –∏–∑–¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 2000 –≥–æ–¥–∞.</span></li>
              <li><code data-i18n="searchHelp.codeExample3">"–≥–∞—Ä—Ä–∏ –ø–æ—Ç—Ç–µ—Ä" OR series:"hogwarts"</code> <span data-i18n="searchHelp.example3">‚Äî —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ñ—Ä–∞–∑—ã –∏–ª–∏ –∫–Ω–∏–≥–∏ –∏–∑ —Å–µ—Ä–∏–∏ ¬´hogwarts¬ª.</span></li>
              <li><code>goodreads:&gt;=4.2</code> <span data-i18n="searchHelp.example4">‚Äî –∫–Ω–∏–≥–∏ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º Goodreads 4.2 –∏ –≤—ã—à–µ.</span></li>
              <li><code>original:"anna: the biography"</code> <span data-i18n="searchHelp.example5">‚Äî –ø–æ–∏—Å–∫ –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –Ω–∞–∑–≤–∞–Ω–∏—é –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º.</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- details modal -->
    <div id="detailsModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width: min(820px, 96vw); max-height: 100%; overflow:auto; background: var(--surface); border:1px solid var(--border); border-radius: 14px; box-shadow: var(--shadow); padding: 16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="modal.bookCard">–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–Ω–∏–≥–∏</h3>
          <button id="closeModalBtn" data-i18n="modal.close">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="display:grid; grid-template-columns: 220px 1fr; gap: 14px; margin-top: 12px;">
          <div>
            <img id="modalCoverPreview" class="cover-preview dropzone" alt="–æ–±–ª–æ–∂–∫–∞" style="display:block; width:100%; height: auto; max-height: 280px;" />
            <div class="row" style="margin-top:8px; gap:8px; align-items:center;">
              <button id="modalChooseCoverBtn" class="btn" style="flex:1; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="0.51" y="0.5" width="13" height="13" rx="1"/><circle cx="9.25" cy="4.75" r="1.75"/><path d="M9.4 13.4999C9.07801 11.7849 8.15715 10.2401 6.80173 9.14113C5.44632 8.04214 3.74452 7.46048 2 7.49993C1.49668 7.49858 0.994381 7.54546 0.5 7.63993"/><path d="M13.5 9.91002C12.6946 9.63803 11.8501 9.49954 11 9.50002C9.92394 9.49768 8.85877 9.71548 7.87 10.14"/></svg>
                <span data-i18n="modal.coverLabel">–û–±–ª–æ–∂–∫–∞‚Ä¶</span>
              </button>
              <button id="modalCoverSearchBtn" type="button" class="btn secondary" style="flex:1; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="7" r="6.5"/><path d="M0.5 7H13.5"/><path d="M9.5 7C9.3772 9.37699 8.50168 11.6533 7 13.5C5.49832 11.6533 4.6228 9.37699 4.5 7C4.6228 4.62301 5.49832 2.34665 7 0.5C8.50168 2.34665 9.3772 4.62301 9.5 7V7Z"/></svg>
                <span data-i18n="modal.findCover">–ù–∞–π—Ç–∏‚Ä¶</span>
              </button>
            </div>
            <div style="margin-top:6px; font-size:12px; color:var(--muted);" id="modalCoverLabel"></div>
            <div style="margin-top:8px;">
              <input id="modalCoverUrlInput" type="url" placeholder="https://example.com/cover.jpg" class="input" style="width:100%; font-size:12px;" />
              <button id="modalLoadCoverBtn" class="btn" style="width:100%; margin-top:4px; font-size:12px;" data-i18n="form.loadByUrl">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ URL</button>
            </div>
            <label style="margin-top:12px;" data-i18n="form.storage">–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</label>
            <div class="row" style="gap:8px; align-items:center;">
              <select id="modalStorageSelect" class="input" style="flex:1; min-width:0;">
                <option value="">‚Äî</option>
              </select>
              <button id="modalStorageQuickAddBtn" type="button" class="btn secondary" style="font-size:12px; white-space:nowrap; display:flex; align-items:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M7 0.540039V13.54"/><path d="M0.5 7H13.5"/></svg>
              </button>
            </div>
            <div class="row" style="margin-top:6px; display:flex; flex-wrap:wrap; gap:8px;">
              <button id="modalStorageHistoryBtn" type="button" class="btn secondary" style="flex:1 1 30%; min-width:110px; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12.5 13.54H3C2.60218 13.54 2.22064 13.382 1.93934 13.1007C1.65804 12.8194 1.5 12.4379 1.5 12.04C1.5 11.6422 1.65804 11.2607 1.93934 10.9794C2.22064 10.6981 2.60218 10.54 3 10.54H11.5C11.7652 10.54 12.0196 10.4347 12.2071 10.2471C12.3946 10.0596 12.5 9.80526 12.5 9.54004V1.54004C12.5 1.27482 12.3946 1.02047 12.2071 0.832932C12.0196 0.645396 11.7652 0.540039 11.5 0.540039H3C2.60901 0.5399 2.23342 0.692433 1.95324 0.965144C1.67305 1.23785 1.51043 1.60919 1.5 2.00004V12"/><path d="M11.5 10.54V13.54"/></svg>
                <span data-i18n="modal.storageHistory">–ò—Å—Ç–æ—Ä–∏—è‚Ä¶</span>
              </button>
              <button id="modalLendBtn" type="button" class="btn" style="flex:1 1 30%; min-width:110px; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 10.5V12.5C13.5 12.7652 13.3946 13.0196 13.2071 13.2071C13.0196 13.3946 12.7652 13.5 12.5 13.5H10.5"/><path d="M10.5 0.5H12.5C12.7652 0.5 13.0196 0.605357 13.2071 0.792893C13.3946 0.98043 13.5 1.23478 13.5 1.5V3.5"/><path d="M0.5 3.5V1.5C0.5 1.23478 0.605357 0.98043 0.792893 0.792893C0.98043 0.605357 1.23478 0.5 1.5 0.5H3.5"/><path d="M3.5 13.5H1.5C1.23478 13.5 0.98043 13.3946 0.792893 13.2071C0.605357 13.0196 0.5 12.7652 0.5 12.5V10.5"/><circle cx="7" cy="4.5" r="2"/><path d="M10.16 10.5001C9.87562 9.90292 9.42786 9.39855 8.86858 9.04543C8.30931 8.6923 7.66142 8.50488 7 8.50488C6.33857 8.50488 5.69068 8.6923 5.13141 9.04543C4.57214 9.39855 4.12437 9.90292 3.84 10.5001"/></svg>
                <span data-i18n="modal.lend">–û—Ç–¥–∞—Ç—å‚Ä¶</span>
              </button>
              <button id="modalReturnBtn" type="button" class="btn" style="flex:1 1 30%; min-width:110px; font-size:12px; display:flex; align-items:center; justify-content:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8L6.05 9.64C6.10506 9.68534 6.16952 9.71784 6.23872 9.73514C6.30791 9.75244 6.38009 9.7541 6.45 9.74C6.52058 9.72676 6.58749 9.69847 6.64616 9.65706C6.70483 9.61564 6.75389 9.56207 6.79 9.5L10 4"/><circle cx="7" cy="7" r="6.5"/></svg>
                <span data-i18n="modal.return">–í–µ—Ä–Ω—É—Ç—å‚Ä¶</span>
              </button>
            </div>
            <div id="modalLoanStatus" class="loan-status" style="display:none;">
              <span class="loan-badge" data-i18n="modal.lent">–û—Ç–¥–∞–Ω–∞</span>
              <div id="modalLoanDetails" class="loan-status-text"></div>
            </div>

            <!-- Reading Status Section -->
            <details id="readingStatusPanel" style="border:1px solid var(--border); border-radius:12px; padding:8px 12px 12px; background:var(--surface); margin-top:12px;">
              <summary style="font-weight:600; cursor:pointer; outline:none; user-select:none;" data-i18n="readingStatus.title">üìö –°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è</summary>
              <div style="margin-top:12px; display:flex; flex-direction:column; gap:12px;">
                <div>
                  <label data-i18n="readingStatus.status">–°—Ç–∞—Ç—É—Å</label>
                  <select id="modalReadingStatus" class="input" style="height:36px;">
                    <option value="" data-i18n="readingStatus.notSet">‚Äî –ù–µ —É–∫–∞–∑–∞–Ω ‚Äî</option>
                    <option value="want_to_read" data-i18n="readingStatus.wantToRead">üîñ –•–æ—á—É –ø—Ä–æ—á–∏—Ç–∞—Ç—å</option>
                    <option value="reading" data-i18n="readingStatus.reading">üìñ –ß–∏—Ç–∞—é</option>
                    <option value="finished" data-i18n="readingStatus.finished">‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                    <option value="re_reading" data-i18n="readingStatus.reReading">üîÅ –ü–µ—Ä–µ—á–∏—Ç—ã–≤–∞—é</option>
                    <option value="abandoned" data-i18n="readingStatus.abandoned">‚ùå –ë—Ä–æ—à–µ–Ω–æ</option>
                    <option value="on_hold" data-i18n="readingStatus.onHold">‚è∏Ô∏è –û—Ç–ª–æ–∂–µ–Ω–æ</option>
                  </select>
                </div>
                <div>
                  <label data-i18n="readingStatus.startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                  <input id="modalReadingStartedAt" type="date" class="input" />
                </div>
                <div>
                  <label data-i18n="readingStatus.endDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                  <input id="modalReadingFinishedAt" type="date" class="input" />
                </div>
                <div id="readingHistorySection" style="display:none; border-top:1px solid var(--border); padding-top:12px;">
                  <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:8px;" data-i18n="readingStatus.readingHistory">–ò—Å—Ç–æ—Ä–∏—è —á—Ç–µ–Ω–∏—è</div>
                  <div id="readingHistoryList" style="display:flex; flex-direction:column; gap:6px;"></div>
                </div>
              </div>
            </details>
          </div>
          <div>
            <label data-i18n="form.title">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input id="modalTitle" type="text" />
            <label data-i18n="form.authors">–ê–≤—Ç–æ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            <input id="modalAuthors" type="text" />
            <div class="row" style="gap:10px;">
              <div style="flex:1;">
                <label data-i18n="form.series">–°–µ—Ä–∏—è</label>
                <input id="modalSeries" type="text" />
              </div>
              <div style="width:140px;">
                <label data-i18n="form.seriesIndex">‚Ññ –≤ —Å–µ—Ä–∏–∏</label>
                <input id="modalSeriesIndex" type="text" />
              </div>
            </div>
            <div class="row" style="gap:10px;">
              <div style="width:140px;">
                <label data-i18n="form.year">–ì–æ–¥</label>
                <input id="modalYear" type="text" />
              </div>
              <div style="flex:1;">
                <label data-i18n="form.publisher">–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</label>
                <div class="row">
                  <input id="modalPublisher" type="text" />
                  <button id="publisherCyrBtn" title="–°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–∏—Ä–∏–ª–ª–∏—Ü—É" data-i18n="form.toCyrillic">–ö–∏—Ä–∏–ª–ª–∏—Ü–µ–π</button>
                </div>
              </div>
            </div>
            <div>
              <label data-i18n="form.isbn">ISBN</label>
              <div class="row" style="gap:8px;">
                <input id="modalIsbn" type="text" style="flex:1;" />
                <button id="aiIsbnSearchBtn" title="–ù–∞–π—Ç–∏ ISBN —á–µ—Ä–µ–∑ AI –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∞–≤—Ç–æ—Ä—É" style="display:flex; align-items:center; gap:8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12.64 1.8699L11.8 4.3499C11.771 4.40726 11.7559 4.47063 11.7559 4.5349C11.7559 4.59917 11.771 4.66255 11.8 4.7199L13.37 6.8199C13.4151 6.88001 13.4424 6.95161 13.4487 7.0265C13.455 7.1014 13.4401 7.17655 13.4056 7.24335C13.3712 7.31015 13.3186 7.36589 13.254 7.40419C13.1893 7.44249 13.1152 7.4618 13.04 7.4599H10.42C10.3558 7.46179 10.2928 7.47804 10.2357 7.50746C10.1786 7.53688 10.1288 7.57872 10.09 7.6299L8.63003 9.7299C8.5872 9.79129 8.52802 9.83943 8.4592 9.86885C8.39038 9.89827 8.31468 9.90779 8.24072 9.89633C8.16676 9.88488 8.09749 9.85289 8.0408 9.80403C7.98411 9.75516 7.94226 9.69137 7.92003 9.6199L7.14002 7.1199C7.12223 7.05811 7.08904 7.00184 7.04357 6.95636C6.99809 6.91089 6.94182 6.8777 6.88003 6.8599L4.38003 6.0799C4.30856 6.05766 4.24477 6.01582 4.1959 5.95913C4.14703 5.90244 4.11505 5.83317 4.10359 5.75921C4.09213 5.68525 4.10166 5.60955 4.13108 5.54073C4.1605 5.47191 4.20864 5.41272 4.27003 5.3699L6.41002 3.8599C6.46121 3.82109 6.50305 3.7713 6.53247 3.71419C6.56189 3.65709 6.57814 3.59411 6.58002 3.5299V0.909903C6.58282 0.841088 6.60333 0.77416 6.63958 0.715598C6.67583 0.657037 6.72658 0.608827 6.78693 0.575637C6.84728 0.542446 6.91517 0.525399 6.98404 0.526147C7.0529 0.526894 7.12041 0.54541 7.18002 0.579903L9.28003 2.1499C9.33334 2.18693 9.39468 2.21077 9.459 2.21946C9.52333 2.22816 9.5888 2.22145 9.65002 2.1999L12.13 1.3599C12.2011 1.33491 12.2779 1.33052 12.3514 1.34724C12.4249 1.36397 12.4922 1.40113 12.5455 1.45443C12.5988 1.50774 12.636 1.57503 12.6527 1.64853C12.6694 1.72204 12.665 1.79878 12.64 1.8699V1.8699Z"/><path d="M7.04 6.95996L0.5 13.5"/></svg>
                  <span data-i18n="form.findIsbn">–ù–∞–π—Ç–∏ ISBN</span>
                </button>
                <button id="isbnSearchBtn" style="display:flex; align-items:center; gap:8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="5.92" cy="5.92" r="5.42"/><path d="M13.5 13.5L9.75 9.75"/></svg>
                  <span data-i18n="form.searchByIsbn">–ü–æ ISBN</span>
                </button>
                <button id="isbnRefreshBtn" title="–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –∏ –æ–±–Ω–æ–≤–∏—Ç—å" style="display:flex; align-items:center; gap:8px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 9L13 8.5L13.5 10.5"/><path d="M13 8.5C12.5558 9.75861 11.749 10.8576 10.6813 11.6584C9.61353 12.4592 8.33262 12.926 6.99999 13C5.7681 13.0002 4.566 12.6213 3.55697 11.9146C2.54794 11.2079 1.78088 10.2078 1.35999 9.05"/><path d="M3 5L1 5.5L0.5 3.5"/><path d="M1 5.5C1.84 3.2 4.42 1 7 1C8.23789 1.00348 9.4444 1.38976 10.4541 2.10588C11.4639 2.822 12.2274 3.8329 12.64 5"/></svg>
                  <span data-i18n="form.refresh">–û–±–Ω–æ–≤–∏—Ç—å</span>
                </button>
              </div>
            </div>
            <div class="row" style="gap:10px; flex-wrap:wrap;">
              <div style="width:180px;">
                <label data-i18n="form.language">–Ø–∑—ã–∫</label>
                <input id="modalLanguage" type="text" />
              </div>
              <div style="width:160px;">
                <label data-i18n="form.format">–§–æ—Ä–º–∞—Ç</label>
                <select id="modalFormat" class="input" style="height:36px;">
                  <option value="" data-i18n="format.none">‚Äî</option>
                  <option value="paper" data-i18n="format.paper">–ë—É–º–∞–∂–Ω–∞—è</option>
                  <option value="ebook" data-i18n="format.ebook">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è</option>
                  <option value="audiobook" data-i18n="format.audiobook">–ê—É–¥–∏–æ</option>
                </select>
              </div>
              <div style="width:140px;">
                <label data-i18n="form.rating">–†–µ–π—Ç–∏–Ω–≥ (0‚Äì5)</label>
                <input id="modalRating" type="text" placeholder="–Ω–∞–ø—Ä. 4.5" data-i18n="form.ratingPlaceholder" data-i18n-attr="placeholder" />
              </div>
              <div style="flex:1; min-width:180px;">
                <label data-i18n="form.genres">–ñ–∞–Ω—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input id="modalGenres" type="text" />
              </div>
              <div style="flex:1; min-width:180px;">
                <label data-i18n="form.tags">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input id="modalTags" type="text" />
              </div>
            </div>
            <div class="row" style="margin-top:8px; gap:8px; align-items:center;">
              <button id="goodreadsLookupBtn" type="button" class="btn secondary" style="display:flex; align-items:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M12.64 1.8699L11.8 4.3499C11.771 4.40726 11.7559 4.47063 11.7559 4.5349C11.7559 4.59917 11.771 4.66255 11.8 4.7199L13.37 6.8199C13.4151 6.88001 13.4424 6.95161 13.4487 7.0265C13.455 7.1014 13.4401 7.17655 13.4056 7.24335C13.3712 7.31015 13.3186 7.36589 13.254 7.40419C13.1893 7.44249 13.1152 7.4618 13.04 7.4599H10.42C10.3558 7.46179 10.2928 7.47804 10.2357 7.50746C10.1786 7.53688 10.1288 7.57872 10.09 7.6299L8.63003 9.7299C8.5872 9.79129 8.52802 9.83943 8.4592 9.86885C8.39038 9.89827 8.31468 9.90779 8.24072 9.89633C8.16676 9.88488 8.09749 9.85289 8.0408 9.80403C7.98411 9.75516 7.94226 9.69137 7.92003 9.6199L7.14002 7.1199C7.12223 7.05811 7.08904 7.00184 7.04357 6.95636C6.99809 6.91089 6.94182 6.8777 6.88003 6.8599L4.38003 6.0799C4.30856 6.05766 4.24477 6.01582 4.1959 5.95913C4.14703 5.90244 4.11505 5.83317 4.10359 5.75921C4.09213 5.68525 4.10166 5.60955 4.13108 5.54073C4.1605 5.47191 4.20864 5.41272 4.27003 5.3699L6.41002 3.8599C6.46121 3.82109 6.50305 3.7713 6.53247 3.71419C6.56189 3.65709 6.57814 3.59411 6.58002 3.5299V0.909903C6.58282 0.841088 6.60333 0.77416 6.63958 0.715598C6.67583 0.657037 6.72658 0.608827 6.78693 0.575637C6.84728 0.542446 6.91517 0.525399 6.98404 0.526147C7.0529 0.526894 7.12041 0.54541 7.18002 0.579903L9.28003 2.1499C9.33334 2.18693 9.39468 2.21077 9.459 2.21946C9.52333 2.22816 9.5888 2.22145 9.65002 2.1999L12.13 1.3599C12.2011 1.33491 12.2779 1.33052 12.3514 1.34724C12.4249 1.36397 12.4922 1.40113 12.5455 1.45443C12.5988 1.50774 12.636 1.57503 12.6527 1.64853C12.6694 1.72204 12.665 1.79878 12.64 1.8699V1.8699Z"/><path d="M7.04 6.95996L0.5 13.5"/></svg>
                <span data-i18n="goodreads.searchGr">–ù–∞–π—Ç–∏ –Ω–∞ Goodreads</span>
              </button>
              <button id="goodreadsRefreshBtn" type="button" class="btn" disabled style="display:flex; align-items:center; gap:8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 9L13 8.5L13.5 10.5"/><path d="M13 8.5C12.5558 9.75861 11.749 10.8576 10.6813 11.6584C9.61353 12.4592 8.33262 12.926 6.99999 13C5.7681 13.0002 4.566 12.6213 3.55697 11.9146C2.54794 11.2079 1.78088 10.2078 1.35999 9.05"/><path d="M3 5L1 5.5L0.5 3.5"/><path d="M1 5.5C1.84 3.2 4.42 1 7 1C8.23789 1.00348 9.4444 1.38976 10.4541 2.10588C11.4639 2.822 12.2274 3.8329 12.64 5"/></svg>
                <span data-i18n="goodreads.refreshGr">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
              </button>
              <span id="goodreadsStatus" style="font-size:12px; color:var(--muted); display:none;"></span>
            </div>
            <details id="goodreadsPanel" class="goodreads-panel">
              <summary data-i18n="goodreads.title">–û—Ä–∏–≥–∏–Ω–∞–ª –∏ –¥–∞–Ω–Ω—ã–µ Goodreads</summary>
              <div class="goodreads-grid">
                <div>
                  <label data-i18n="form.originalTitle">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (EN)</label>
                  <input id="modalOriginalTitleEn" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, Anna: The Biography" />
                </div>
                <div>
                  <label data-i18n="form.originalAuthors">–ê–≤—Ç–æ—Ä—ã (EN, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                  <input id="modalOriginalAuthorsEn" type="text" placeholder="Amy Odell" />
                </div>
                <div>
                  <label data-i18n="goodreads.grRating">–û—Ü–µ–Ω–∫–∞ Goodreads</label>
                  <input id="modalGoodreadsRating" type="text" placeholder="‚Äî" readonly />
                </div>
                <div>
                  <label data-i18n="goodreads.grRatingsCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫</label>
                  <input id="modalGoodreadsRatingsCount" type="text" placeholder="‚Äî" readonly />
                </div>
                <div>
                  <label data-i18n="goodreads.grReviewsCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤</label>
                  <input id="modalGoodreadsReviewsCount" type="text" placeholder="‚Äî" readonly />
                </div>
                <div>
                  <label data-i18n="goodreads.grLink">–°—Å—ã–ª–∫–∞ –Ω–∞ Goodreads</label>
                  <input id="modalGoodreadsUrl" type="text" placeholder="https://www.goodreads.com/..." style="text-transform:none;" />
                </div>
              </div>
              <div id="goodreadsFetchedLabel" style="margin-top:8px; font-size:12px; color:var(--muted);"></div>
            </details>
            <div id="goodreadsResultBox" class="card" style="display:none; margin-top:8px;">
              <div style="font-size:12px; color:var(--muted); margin-bottom:4px;">–ù–∞–π–¥–µ–Ω–æ –Ω–∞ Goodreads</div>
              <div id="goodreadsResultContent" style="display:flex; flex-direction:column; gap:8px; font-size:13px;"></div>
            </div>
            <label data-i18n="form.notes">–ó–∞–º–µ—Ç–∫–∏</label>
            <textarea id="modalNotes" rows="3" style="resize:vertical;"></textarea>

            <div id="isbnResults" class="card" style="margin-top:12px; display:none;">
              <div style="font-size:12px; color:var(--muted); margin-bottom:6px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
              <div id="isbnResultsList" style="display:flex; flex-direction:column; gap:8px;"></div>
            </div>
            <div class="row" style="margin-top:12px; gap:8px;">
              <button id="modalSaveBtn" class="primary" style="display:flex; align-items:center; gap:6px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8L6.05 9.64C6.10506 9.68534 6.16952 9.71784 6.23872 9.73514C6.30791 9.75244 6.38009 9.7541 6.45 9.74C6.52058 9.72676 6.58749 9.69847 6.64616 9.65706C6.70483 9.61564 6.75389 9.56207 6.79 9.5L10 4"/><circle cx="7" cy="7" r="6.5"/></svg>
                <span data-i18n="form.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
              </button>
              <button id="modalCollectionsBtn" class="btn secondary" style="display:flex; align-items:center; gap:6px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 13.5L7 9.5L3 13.5V1.5C3 1.23478 3.10536 0.98043 3.29289 0.792893C3.48043 0.605357 3.73478 0.5 4 0.5H10C10.2652 0.5 10.5196 0.605357 10.7071 0.792893C10.8946 0.98043 11 1.23478 11 1.5V13.5Z"/></svg>
                <span data-i18n="modal.collections">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</span>
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- CSV import modal -->
    <div id="csvImportModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:55; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(860px, 96vw); max-height:100%; overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="csvImport.title">–ò–º–ø–æ—Ä—Ç –∫–Ω–∏–≥ –∏–∑ CSV / TSV</h3>
          <button id="csvImportCloseBtn" class="icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-i18n="modal.close" data-i18n-attr="title" style="width:32px; height:32px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
          </button>
        </div>
        <div style="font-size:13px; color:var(--muted);" data-i18n="csvImport.description">
          –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV/TSV —Ñ–∞–π–ª, —Å–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –ø–æ–ª—è–º–∏ –∫–Ω–∏–≥–∏ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø–∏—Å–∏. –ê–≤—Ç–æ—Ä—ã, —Ç–µ–≥–∏ –∏ –∂–∞–Ω—Ä—ã —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –∑–∞–ø—è—Ç—ã–º–∏ –∏–ª–∏ —Ç–æ—á–∫–æ–π —Å –∑–∞–ø—è—Ç–æ–π.
        </div>
        <div class="row" style="gap:12px; align-items:flex-end; flex-wrap:wrap;">
          <div>
            <label data-i18n="csvImport.file">–§–∞–π–ª CSV/TSV</label>
            <input id="csvImportFile" type="file" accept=".csv,.tsv,text/csv,text/tab-separated-values" />
          </div>
          <div class="row" style="gap:6px; align-items:center;">
            <input id="csvImportHeaderless" type="checkbox" />
            <label for="csvImportHeaderless" style="margin:0;" data-i18n="csvImport.noHeader">–ù–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –¥–∞–Ω–Ω—ã–µ)</label>
          </div>
          <button id="csvImportParseBtn" class="btn" data-i18n="csvImport.load">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
        <div id="csvImportMapping" style="display:none; border:1px solid var(--border); border-radius:12px; padding:12px; background:var(--muted-surface);">
          <div style="font-size:12px; color:var(--muted); margin-bottom:8px;" data-i18n="csvImport.mapColumns">–°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–ª–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞ —Å –ø–æ–ª—è–º–∏ –∫–Ω–∏–≥–∏</div>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(160px, 1fr)); gap:10px;">
            <div><label data-i18n="csvImport.mapTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</label><select id="csvMapTitle" class="input"></select></div>
            <div><label data-i18n="csvImport.mapAuthors">–ê–≤—Ç–æ—Ä—ã</label><select id="csvMapAuthors" class="input"></select></div>
            <div><label data-i18n="csvImport.mapIsbn">ISBN</label><select id="csvMapIsbn" class="input"></select></div>
            <div><label data-i18n="csvImport.mapPublisher">–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ</label><select id="csvMapPublisher" class="input"></select></div>
            <div><label data-i18n="csvImport.mapYear">–ì–æ–¥</label><select id="csvMapYear" class="input"></select></div>
            <div><label data-i18n="csvImport.mapLanguage">–Ø–∑—ã–∫</label><select id="csvMapLanguage" class="input"></select></div>
            <div><label data-i18n="csvImport.mapSeries">–°–µ—Ä–∏—è</label><select id="csvMapSeries" class="input"></select></div>
            <div><label data-i18n="csvImport.mapSeriesIndex">‚Ññ –≤ —Å–µ—Ä–∏–∏</label><select id="csvMapSeriesIndex" class="input"></select></div>
            <div><label data-i18n="csvImport.mapFormat">–§–æ—Ä–º–∞—Ç</label><select id="csvMapFormat" class="input"></select></div>
            <div><label data-i18n="csvImport.mapGenres">–ñ–∞–Ω—Ä—ã</label><select id="csvMapGenres" class="input"></select></div>
            <div><label data-i18n="csvImport.mapTags">–¢–µ–≥–∏</label><select id="csvMapTags" class="input"></select></div>
            <div><label data-i18n="csvImport.mapRating">–†–µ–π—Ç–∏–Ω–≥</label><select id="csvMapRating" class="input"></select></div>
            <div><label data-i18n="csvImport.mapNotes">–ó–∞–º–µ—Ç–∫–∏</label><select id="csvMapNotes" class="input"></select></div>
            <div><label data-i18n="csvImport.mapCover">–û–±–ª–æ–∂–∫–∞ (URL)</label><select id="csvMapCover" class="input"></select></div>
          </div>
        </div>
        <div id="csvImportPreview" style="display:none;">
          <div style="font-weight:600; margin-bottom:6px;" data-i18n="csvImport.preview">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (–ø–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π)</div>
          <div id="csvImportPreviewList" style="display:flex; flex-direction:column; gap:8px;"></div>
        </div>
        <div id="csvImportSummary" style="font-size:12px; color:var(--muted); display:none;"></div>
        <div class="row" style="justify-content:flex-end; gap:8px;">
          <button id="csvImportCancelBtn" class="btn" data-i18n="actions.cancel">–û—Ç–º–µ–Ω–∞</button>
          <button id="csvImportConfirmBtn" class="btn primary" disabled data-i18n="csvImport.import">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    </div>

    <div id="storageManagerModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:56; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(900px,96vw); max-height:100%; overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="storage.title">–ú–µ—Å—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è</h3>
          <button id="storageManagerCloseBtn" class="icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-i18n="modal.close" data-i18n-attr="title" style="width:32px; height:32px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
          </button>
        </div>
        <div style="font-size:12px; color:var(--muted);" data-i18n="storage.description">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–¥—ã –¥–ª—è —à–∫–∞—Ñ–æ–≤, –ø–æ–ª–æ–∫ –∏ –æ—Å–æ–±—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RN ‚Äî ¬´—á–∏—Ç–∞—é —Å–µ–π—á–∞—Å¬ª).</div>
        <div style="display:flex; gap:16px; flex-wrap:wrap;">
          <div style="flex:2 1 360px; min-width:320px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <h4 style="margin:0; font-size:14px;" data-i18n="storage.list">–°–ø–∏—Å–æ–∫</h4>
              <button id="storageCreateBtn" class="btn secondary" type="button" data-i18n="storage.add">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div id="storageList" style="display:flex; flex-direction:column; gap:8px;"></div>
          </div>
          <div style="flex:1 1 260px; min-width:260px; border:1px solid var(--border); border-radius:12px; padding:12px; background:var(--muted-surface);">
            <h4 style="margin:0 0 8px 0; font-size:14px;" data-i18n="storage.editing">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
            <div class="form-grid" style="display:flex; flex-direction:column; gap:8px;">
              <label data-i18n="storage.code">–ö–æ–¥</label>
              <input id="storageFormCode" type="text" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, R1-A1-S7" data-i18n="storage.codePlaceholder" data-i18n-attr="placeholder" />
              <label data-i18n="storage.descriptionLabel">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <input id="storageFormTitle" type="text" class="input" placeholder="–ö–æ–º–Ω–∞—Ç–∞/—Å—Ç–µ–ª–ª–∞–∂/–ø–æ–ª–∫–∞" data-i18n="storage.descPlaceholder" data-i18n-attr="placeholder" />
              <label data-i18n="storage.note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
              <textarea id="storageFormNote" rows="2" class="input" style="resize:vertical;"></textarea>
              <label style="display:flex; align-items:center; gap:6px;">
                <input id="storageFormActive" type="checkbox" checked /> <span data-i18n="storage.active">–ê–∫—Ç–∏–≤–Ω–æ</span>
              </label>
              <label data-i18n="storage.sortOrder">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
              <input id="storageFormSort" type="number" class="input" value="0" />
              <div class="row" style="justify-content:flex-end; gap:8px;">
                <button id="storageFormCancel" type="button" class="btn" data-i18n="actions.cancel">–û—Ç–º–µ–Ω–∞</button>
                <button id="storageFormSave" type="button" class="btn primary" data-i18n="form.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="storageHistoryModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:57; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(720px,92vw); max-height:100%; overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="storage.movementHistory">–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π</h3>
          <button id="storageHistoryCloseBtn" class="icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-i18n="modal.close" data-i18n-attr="title" style="width:32px; height:32px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
          </button>
        </div>
        <div id="storageHistoryList" style="display:flex; flex-direction:column; gap:10px;"></div>
      </div>
    </div>

    <div id="storageLoanModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:58; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(420px,90vw); max-height:100%; overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 id="storageLoanTitle" style="margin:0;" data-i18n="storage.lendBook">–í—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏</h3>
          <button id="storageLoanCloseBtn" class="icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-i18n="modal.close" data-i18n-attr="title" style="width:32px; height:32px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
          </button>
        </div>
        <div id="storageLoanContext" style="font-size:12px; color:var(--muted);"></div>
        <div id="storageLoanPersonRow" style="display:flex; flex-direction:column; gap:6px;">
          <label data-i18n="storage.lendTo">–ö–æ–º—É –ø–µ—Ä–µ–¥–∞—ë–º</label>
          <input id="storageLoanPerson" type="text" class="input" placeholder="–ò–º—è / –ø–æ–ª—É—á–∞—Ç–µ–ª—å" data-i18n="storage.recipientPlaceholder" data-i18n-attr="placeholder" />
        </div>
        <div id="storageLoanLocationRow" style="display:flex; flex-direction:column; gap:6px;">
          <label data-i18n="form.storage">–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</label>
          <select id="storageLoanLocation" class="input">
            <option value="">‚Äî</option>
          </select>
        </div>
        <div style="display:flex; flex-direction:column; gap:6px;">
          <label data-i18n="storage.note">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
          <textarea id="storageLoanNote" rows="2" class="input" style="resize:vertical;"></textarea>
        </div>
        <div class="row" style="justify-content:flex-end; gap:8px;">
          <button id="storageLoanCancel" class="btn" data-i18n="actions.cancel">–û—Ç–º–µ–Ω–∞</button>
          <button id="storageLoanSave" class="btn primary" data-i18n="form.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <div id="coverSearchModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:56; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width:min(900px,96vw); max-height:100%; overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:18px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="coverSearch.title">–ü–æ–∏—Å–∫ –æ–±–ª–æ–∂–∫–∏ –æ–Ω–ª–∞–π–Ω</h3>
          <button id="coverSearchCloseBtn" class="icon-btn" title="–ó–∞–∫—Ä—ã—Ç—å" data-i18n="modal.close" data-i18n-attr="title" style="width:32px; height:32px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 0.5L0.5 13.5"/><path d="M0.5 0.5L13.5 13.5"/></svg>
          </button>
        </div>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <input id="coverSearchQuery" type="text" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –§–∏–ª–æ—Å–æ—Ñ–∏—è –ø–∞–Ω–∫–∞ –æ–±–ª–æ–∂–∫–∞" data-i18n="coverSearch.placeholder" data-i18n-attr="placeholder" style="flex:1; min-width:240px;" />
          <button id="coverSearchSubmit" class="btn primary" type="button" data-i18n="coverSearch.find">–ù–∞–π—Ç–∏</button>
          <span id="coverSearchInfo" style="font-size:12px; color:var(--muted);"></span>
        </div>
        <div id="coverSearchStatus" style="font-size:13px; color:var(--muted);"></div>
        <div id="coverSearchResults" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); gap:12px;"></div>
      </div>
    </div>

    <!-- info modal (read-only) -->
    <div id="infoModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width: min(820px, 96vw); max-height: 100%; overflow:auto; background: var(--surface); border:1px solid var(--border); border-radius: 14px; box-shadow: var(--shadow); padding: 16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="infoModal.title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ</h3>
          <button id="closeInfoBtn" data-i18n="modal.close">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="display:grid; grid-template-columns: 220px 1fr; gap: 14px; margin-top: 12px;">
          <div>
            <img id="infoCover" alt="–æ–±–ª–æ–∂–∫–∞" style="display:none; width:100%; height:auto; max-height: 320px; object-fit:contain; border:1px solid var(--border); border-radius:10px; background: var(--muted-surface);" />
          </div>
          <div id="infoContent" style="display:flex; flex-direction:column; gap:8px;"></div>
        </div>
      </div>
    </div>

    <!-- settings modal -->
    <div id="settingsModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.35);"></div>
      <div class="modal-card" style="position:relative; width: min(560px, 96vw); max-height: 100%; overflow:auto; background: var(--surface); border:1px solid var(--border); border-radius: 14px; box-shadow: var(--shadow); padding: 16px;">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <h3 style="margin:0;" data-i18n="header.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
          <button id="closeSettingsBtn" data-i18n="modal.close">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="margin-top: 12px; display:flex; flex-direction:column; gap:10px;">
          <div>
            <label data-i18n="settings.language">–Ø–∑—ã–∫ / Language</label>
            <select id="settingsLanguage" class="input">
              <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
              <option value="en">üá¨üáß English</option>
            </select>
          </div>
          <div>
            <label>ISBNdb API Key</label>
            <input id="settingsIsbndbKey" type="text" placeholder="sk_xxx" />
            <div style="font-size:12px; color:var(--muted);" data-i18n="settings.storedLocally">–•—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ userData/settings.json</div>
          </div>
          <div>
            <label data-i18n="settings.googleBooksKey">Google Books API Key (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <input id="settingsGoogleKey" type="text" placeholder="AIza..." />
          </div>
          <div>
            <label data-i18n="settings.aiProvider">AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ ISBN</label>
            <select id="settingsAiProvider" class="input">
              <option value="openai" data-i18n="settings.openaiProvider">OpenAI (GPT-5, o1-preview)</option>
              <option value="perplexity" data-i18n="settings.perplexityProvider">Perplexity (–¥–µ—à–µ–≤–ª–µ, —Å –ø–æ–∏—Å–∫–æ–º) üí∞</option>
            </select>
          </div>
          <div id="openaiSettings">
            <label data-i18n="settings.openaiKey">OpenAI API Key</label>
            <input id="settingsOpenAIKey" type="text" placeholder="sk-..." />
          </div>
          <div id="perplexitySettings" style="display:none;">
            <label data-i18n="settings.perplexityKey">Perplexity API Key</label>
            <input id="settingsPerplexityKey" type="text" placeholder="pplx-..." />
          </div>
          <div id="openaiExtraSettings">
            <div>
              <label data-i18n="settings.openaiBaseUrl">OpenAI API Base URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="settingsOpenAIBase" type="text" placeholder="https://api.openai.com/v1" />
            </div>
            <div>
              <label data-i18n="settings.openaiModel">OpenAI Model (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <select id="settingsOpenAIModel" class="input">
                <option value="gpt-5" data-i18n="settings.modelGpt5">GPT-5 (–Ω–æ–≤–µ–π—à–∞—è) üöÄ</option>
                <option value="o1-preview" data-i18n="settings.modelO1Preview">o1-preview (reasoning) üß†</option>
                <option value="gpt-4o" data-i18n="settings.modelGpt4o">gpt-4o (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è)</option>
                <option value="o1-mini" data-i18n="settings.modelO1Mini">o1-mini (reasoning, –±—ã—Å—Ç—Ä–∞—è) ‚ö°</option>
                <option value="gpt-4o-mini" data-i18n="settings.modelGpt4oMini">gpt-4o-mini (–±—ã—Å—Ç—Ä–∞—è, –¥–µ—à–µ–≤–∞—è) üí∞</option>
                <option value="gpt-4-turbo" data-i18n="settings.modelGpt4Turbo">gpt-4-turbo</option>
                <option value="gpt-4" data-i18n="settings.modelGpt4">gpt-4 (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è)</option>
              </select>
            </div>
          </div>
          <div id="perplexityExtraSettings" style="display:none;">
            <div>
              <label data-i18n="settings.perplexityModel">Perplexity Model</label>
              <select id="settingsPerplexityModel" class="input">
                <option value="sonar" data-i18n="settings.perplexitySonar">Sonar ($1/$1) - –¥–µ—à–µ–≤–æ, –±—ã—Å—Ç—Ä–æ üí∞</option>
                <option value="sonar-reasoning" data-i18n="settings.perplexitySonarReasoning">Sonar Reasoning ($1/$5) - —Å –ª–æ–≥–∏–∫–æ–π</option>
                <option value="sonar-reasoning-pro" data-i18n="settings.perplexitySonarReasoningPro">Sonar Reasoning Pro ($2/$8) - —É–º–Ω–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ</option>
                <option value="sonar-pro" data-i18n="settings.perplexitySonarPro">Sonar Pro ($3/$15) - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫</option>
              </select>
            </div>
            <div style="margin-top:8px;">
              <button id="checkPerplexityBalance" type="button" class="secondary" data-i18n="settings.openPerplexityBilling">
                üí∞ –û—Ç–∫—Ä—ã—Ç—å –±–∏–ª–ª–∏–Ω–≥ Perplexity
              </button>
            </div>
          </div>
          <div style="margin-top:8px;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input id="settingsOpenAIDisableCache" type="checkbox" />
              <span data-i18n="settings.disableAiCache">–û—Ç–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)</span>
            </label>
          </div>
          <div style="margin-top:8px;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input id="settingsAiStrictMode" type="checkbox" />
              <span data-i18n="settings.aiStrictMode">üéØ –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º AI –ø–æ–∏—Å–∫–∞ (–º–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ —Ç–æ—á–Ω–µ–µ)</span>
            </label>
          </div>

          <div style="margin-top:16px; padding:12px; background:var(--muted-surface); border-radius:8px;">
            <h4 style="margin:0 0 8px 0; font-size:14px; font-weight:600;" data-i18n="settings.sync">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h4>
            <div style="display:flex; flex-direction:column; gap:8px;">
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <div>
                  <label>S3 Endpoint</label>
                  <input id="settingsS3Endpoint" type="url" placeholder="https://s3.amazonaws.com" class="input" style="width:100%;" />
                </div>
                <div>
                  <label>S3 Region</label>
                  <input id="settingsS3Region" type="text" placeholder="us-east-1" class="input" style="width:100%;" />
                </div>
              </div>
              <div>
                <label>S3 Bucket</label>
                <input id="settingsS3Bucket" type="text" placeholder="my-library-sync" class="input" style="width:100%;" />
              </div>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <div>
                  <label>Access Key ID</label>
                  <input id="settingsS3AccessKey" type="text" placeholder="AKIA..." class="input" style="width:100%;" />
                </div>
                <div>
                  <label>Secret Access Key</label>
                  <input id="settingsS3SecretKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input" style="width:100%;" />
                </div>
              </div>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer; margin-top:8px;">
                <input id="settingsAutoSync" type="checkbox" />
                <span data-i18n="settings.autoSync">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ</span>
              </label>
              <div style="font-size:11px; color:var(--muted); margin-left:24px;" data-i18n="settings.autoSyncHint">
                üí° –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
              </div>
              <div style="margin-top:8px;">
                <button id="testSyncBtn" type="button" class="btn" data-i18n="settings.testS3">
                  üîó –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ S3
                </button>
              </div>
              <div style="margin-top:8px;">
                <button id="cleanupCoversBtn" type="button" class="btn secondary" data-i18n="settings.cleanupCovers">
                  üßπ –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±–ª–æ–∂–∫–∏
                </button>
                <div style="font-size:11px; color:var(--muted); margin-top:4px;" data-i18n="settings.cleanupCoversHint">
                  üí° –£–¥–∞–ª—è–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–ª–æ–∂–∫–∏ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∫–Ω–∏–≥
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top:16px; padding:12px; background:var(--muted-surface); border-radius:8px;">
            <h4 style="margin:0 0 8px 0; font-size:14px; font-weight:600;" data-i18n="settings.hotkeys">‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h4>
            <div style="font-size:12px; color:var(--muted); line-height:1.4;">
              <div style="display:grid; grid-template-columns:auto 1fr; gap:8px 12px; align-items:baseline;">
                <code style="background:var(--surface); padding:2px 6px; border-radius:4px; font-size:11px;">Escape</code>
                <span data-i18n="settings.hotkeyEscape">–ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞</span>

                <code style="background:var(--surface); padding:2px 6px; border-radius:4px; font-size:11px;">/</code>
                <span data-i18n="settings.hotkeySearch">–§–æ–∫—É—Å –Ω–∞ –ø–æ–∏—Å–∫</span>

                <code style="background:var(--surface); padding:2px 6px; border-radius:4px; font-size:11px;">N</code>
                <span data-i18n="settings.hotkeyNewBook">–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞</span>

                <code style="background:var(--surface); padding:2px 6px; border-radius:4px; font-size:11px;">Enter</code>
                <span data-i18n="settings.hotkeySave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</span>

                <code style="background:var(--surface); padding:2px 6px; border-radius:4px; font-size:11px;">Delete</code>
                <span data-i18n="settings.hotkeyDelete">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–∏–≥—É</span>
              </div>
              <div style="margin-top:8px; font-size:11px; opacity:0.7;" data-i18n="settings.hotkeysNote">
                üí° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª—è
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:12px;">
            <button id="saveSettingsBtn" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <div id="vocabManagerModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60; padding:24px 12px; box-sizing:border-box;">
      <div class="modal-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.45); backdrop-filter:blur(2px);"></div>
      <div class="modal-card" style="position:relative; width:min(720px,96vw); max-height:100%; overflow:hidden; background:var(--surface); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); display:flex; flex-direction:column;">
        <div style="display:flex; align-items:center; justify-content:space-between; padding:16px; border-bottom:1px solid var(--border);">
          <div>
            <h3 style="margin:0;" data-i18n="vocab.title">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
            <div style="font-size:12px; color:var(--muted); margin-top:4px;" data-i18n="vocab.description">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∂–∞–Ω—Ä–∞–º–∏, —Ç–µ–≥–∞–º–∏, –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏, –∞–≤—Ç–æ—Ä–∞–º–∏ –∏ —Å–µ—Ä–∏—è–º–∏</div>
          </div>
          <button id="vocabManagerCloseBtn" class="btn" data-i18n="modal.close">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div style="padding:16px; display:flex; flex-direction:column; gap:12px; overflow:auto;">
          <div style="display:flex; flex-wrap:wrap; gap:8px;" id="vocabTabs">
            <button type="button" class="btn secondary active" data-vocab-tab="genres" data-i18n="vocab.genres">–ñ–∞–Ω—Ä—ã</button>
            <button type="button" class="btn secondary" data-vocab-tab="tags" data-i18n="vocab.tags">–¢–µ–≥–∏</button>
            <button type="button" class="btn secondary" data-vocab-tab="publisher" data-i18n="vocab.publishers">–ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</button>
            <button type="button" class="btn secondary" data-vocab-tab="series" data-i18n="vocab.series">–°–µ—Ä–∏–∏</button>
            <button type="button" class="btn secondary" data-vocab-tab="authors" data-i18n="vocab.authors">–ê–≤—Ç–æ—Ä—ã</button>
          </div>
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <button id="vocabAddBtn" type="button" class="btn primary" data-i18n="vocab.addValue">–î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
            <span style="font-size:12px; color:var(--muted);" data-i18n="vocab.addHint">–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫–∏.</span>
          </div>
          <div id="vocabList" style="display:flex; flex-direction:column; gap:8px; max-height:55vh; overflow:auto;"></div>
        </div>
      </div>
    </div>

    <script src="renderer/utils.js"></script>
    <script src="renderer/state.js"></script>
    <script src="renderer/vocab_manager.js"></script>
    <script src="renderer.js"></script>
  </body>
  </html>
