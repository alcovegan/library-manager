# Library Manager

Десктопное приложение для управления личной книжной коллекцией. Построено на Electron.

## Возможности

### Управление книгами

- **Полный CRUD**: Создание, просмотр, редактирование и удаление книг
- **Богатые метаданные**: Название, авторы, серия, год, издательство, ISBN, язык, формат
- **Рейтинги**: Личный рейтинг (1-5 звёзд с поддержкой половинок) и интеграция с Goodreads
- **Обложки**: Загрузка локальных файлов или поиск онлайн через Google Books
- **Теги и жанры**: Организация книг с помощью множественных тегов и жанров
- **Заметки**: Добавление личных заметок к любой книге

### Отслеживание чтения

Статусы чтения:
- Хочу прочитать
- Читаю (автоматически ставит дату начала)
- Прочитано (автоматически ставит дату окончания)
- Перечитываю
- Брошено
- Отложено

История сессий чтения сохраняется для каждой книги.

### Места хранения и выдача

- **Отслеживание физического хранения**: Определение мест (полки, комнаты, коробки) с кодами
- **Выдача книг**: Запись кому и когда выдана книга
- **История перемещений**: Полная хронология где была каждая книга
- **Отслеживание возвратов**: Логирование возврата книг с заметками

### Коллекции

- **Статические коллекции**: Вручную составленные списки книг
- **Коллекции по фильтрам**: Динамические коллекции на основе критериев поиска
- **Визуальные метки**: Отображение принадлежности к коллекциям на карточках

### Поиск и фильтрация

- **Нечёткий поиск**: Поиск по названию или автору с допуском опечаток (Fuse.js)
- **Расширенные фильтры**: Автор, формат, диапазон годов, рейтинг Goodreads, жанры, теги, статус чтения
- **Логические операторы**: Использование `AND`, `OR`, `NOT` в поисковых запросах
- **Поиск по полям**: `title:`, `author:`, `tag:`, `genre:`, `year>=`, `rating>=`
- **Пресеты фильтров**: Сохранение и быстрое применение комбинаций фильтров

### Импорт и экспорт

- **Импорт CSV/TSV**: Массовый импорт с автоопределением разделителя, маппингом колонок, предпросмотром
- **JSON бэкап**: Полный экспорт/импорт библиотеки со встроенными обложками
- **Экспорт истории**: Экспорт журнала активности в JSON

### Облачная синхронизация (S3)

- **Синхронизация между устройствами**: Синхронизация библиотеки через S3-совместимое хранилище
- **Выборочная синхронизация**: База данных, настройки и обложки
- **Защита версий**: Предотвращение перезаписи новой схемы старой версией приложения
- **Отслеживание устройств**: Информация о последней синхронизации

### AI-функции

- **Поиск ISBN**: Поиск ISBN по названию и автору через AI (OpenAI или Perplexity)
- **Обогащение из Goodreads**: Автоматическое получение рейтингов, количества отзывов, оригинальных названий
- **Кэширование результатов**: 30-дневный кэш для минимизации API-запросов
- **Строгий режим**: Настраиваемые пороги уверенности для снижения ложных срабатываний

### Поиск обложек

- **Google Books**: Основной источник обложек
- **DuckDuckGo fallback**: Альтернативный поиск изображений
- **Фильтр качества**: Минимальная ширина 500px для хорошего качества
- **Предпросмотр и выбор**: Выбор из нескольких вариантов обложек

### История активности

- **Полный аудит**: Все операции логируются с временными метками
- **Отслеживаемые действия**: CRUD книг, перемещения, выдачи, коллекции, синхронизация, импорты
- **Просмотр истории**: Фильтрация по типу, поиск, пагинация
- **Экспорт**: Сохранение истории в JSON

### Управление словарём

- **Автоподсказки**: Автодополнение для авторов, серий, издательств, жанров, тегов
- **Массовое переименование**: Переименование значения во всех книгах сразу
- **Пользовательские записи**: Ручное добавление новых значений словаря

### Настройки

- **API-ключи**: ISBNdb, Google Books, OpenAI, Perplexity
- **AI-провайдер**: Выбор между OpenAI и Perplexity для обогащения
- **Конфигурация S3**: Endpoint, регион, bucket, credentials
- **Тема**: Светлый и тёмный режим
- **Автосинхронизация**: Включение автоматической облачной синхронизации

## Установка

### Из релиза

Скачайте последний релиз для вашей платформы:
- **macOS**: `.dmg` или `.zip`
- **Windows**: `.exe` (установщик) или portable
- **Linux**: `.AppImage` или `.deb`

### Из исходников

Требования: Node.js 20+

```bash
git clone <repository-url>
cd library-manager
npm install
npm start
```

### Сборка

```bash
npm run dist          # Сборка для текущей платформы
npm run publish       # Сборка и публикация в GitHub Releases
```

## Конфигурация

Создайте файл `.env` в корне проекта (не коммитится в git):

```env
# Поиск ISBN (опционально)
ISBNDB_API_KEY=your_key

# Поиск обложек (опционально, увеличивает лимиты)
GOOGLE_BOOKS_API_KEY=your_key

# AI-обогащение - один или оба
OPENAI_API_KEY=your_key
PERPLEXITY_API_KEY=your_key

# S3-синхронизация (опционально)
S3_ENDPOINT=https://s3.amazonaws.com
S3_REGION=us-east-1
S3_BUCKET=your-bucket
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key

# Автообновление из приватного GitHub репо (опционально)
GH_TOKEN=your_github_token
```

## Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| `/` | Фокус на поиск |
| `N` | Новая книга |
| `Enter` | Сохранить форму |
| `Delete` | Удалить выбранную книгу |
| `Escape` | Закрыть модальное окно |

Горячие клавиши отключены при вводе в текстовые поля.

## Технологии

- **Фреймворк**: Electron 38
- **База данных**: SQLite через sql.js (WebAssembly)
- **Поиск**: Fuse.js
- **Парсинг CSV**: PapaParse
- **Облачное хранилище**: AWS SDK (S3-совместимое)
- **AI**: OpenAI SDK (поддержка OpenAI и Perplexity)
- **Автообновления**: electron-updater

## Хранение данных

Все данные хранятся локально в директории пользователя:
- **macOS**: `~/Library/Application Support/Library Manager/`
- **Windows**: `%APPDATA%/Library Manager/`
- **Linux**: `~/.config/Library Manager/`

Содержимое:
- `data/library.db` — SQLite база данных
- `data/covers/` — Обложки книг
- `data/settings.json` — Настройки приложения

## Тестирование

```bash
npm run test:unit     # Запуск unit-тестов (Vitest)
npm run test:watch    # Watch-режим
npm run test:e2e      # Запуск E2E-тестов (Playwright)
```

## Лицензия

ISC
